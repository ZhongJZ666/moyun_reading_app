{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport { Bell, ChatDotRound, User } from '@element-plus/icons-vue';\nimport { formatDistanceToNow } from 'date-fns';\nimport { zhCN } from 'date-fns/locale';\nexport default {\n  name: 'MessageList',\n  components: {\n    Bell,\n    ChatDotRound,\n    User\n  },\n  data() {\n    return {\n      messages: [],\n      activeType: 'all',\n      loading: false,\n      hasMore: true,\n      page: 1,\n      pageSize: 20\n    };\n  },\n  created() {\n    this.fetchMessages();\n  },\n  methods: {\n    async fetchMessages() {\n      this.loading = true;\n      try {\n        const response = await this.$http.get('/api/messages', {\n          params: {\n            page: this.page,\n            size: this.pageSize,\n            type: this.activeType === 'all' ? undefined : this.activeType\n          }\n        });\n        if (this.page === 1) {\n          this.messages = response.data.items;\n        } else {\n          this.messages.push(...response.data.items);\n        }\n        this.hasMore = response.data.hasMore;\n      } catch (error) {\n        this.$message.error('获取消息列表失败');\n      } finally {\n        this.loading = false;\n      }\n    },\n    handleTypeChange() {\n      this.page = 1;\n      this.fetchMessages();\n    },\n    async loadMore() {\n      this.page++;\n      await this.fetchMessages();\n    },\n    getMessageIcon(type) {\n      const icons = {\n        system: 'Bell',\n        private: 'ChatDotRound',\n        group: 'User'\n      };\n      return icons[type] || 'Bell';\n    },\n    formatTime(time) {\n      return formatDistanceToNow(new Date(time), {\n        addSuffix: true,\n        locale: zhCN\n      });\n    },\n    async handleMessageClick(message) {\n      if (!message.read) {\n        await this.markAsRead(message);\n      }\n      this.$router.push(`/messages/${message.id}`);\n    },\n    async markAsRead(message) {\n      try {\n        await this.$http.put(`/api/messages/${message.id}/read`);\n        message.read = true;\n      } catch (error) {\n        this.$message.error('标记已读失败');\n      }\n    },\n    async markAllRead() {\n      try {\n        await this.$http.put('/api/messages/read-all');\n        this.messages.forEach(m => m.read = true);\n        this.$message.success('已全部标为已读');\n      } catch (error) {\n        this.$message.error('操作失败');\n      }\n    },\n    async deleteMessage(message) {\n      try {\n        await this.$confirm('确定要删除这条消息吗？', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        });\n        await this.$http.delete(`/api/messages/${message.id}`);\n        const index = this.messages.findIndex(m => m.id === message.id);\n        if (index !== -1) {\n          this.messages.splice(index, 1);\n        }\n      } catch (error) {\n        if (error !== 'cancel') {\n          this.$message.error('删除失败');\n        }\n      }\n    },\n    async clearAll() {\n      try {\n        await this.$confirm('确定要清空所有消息吗？', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        });\n        await this.$http.delete('/api/messages');\n        this.messages = [];\n        this.$message.success('消息已清空');\n      } catch (error) {\n        if (error !== 'cancel') {\n          this.$message.error('清空失败');\n        }\n      }\n    }\n  }\n};","map":{"version":3,"names":["Bell","ChatDotRound","User","formatDistanceToNow","zhCN","name","components","data","messages","activeType","loading","hasMore","page","pageSize","created","fetchMessages","methods","response","$http","get","params","size","type","undefined","items","push","error","$message","handleTypeChange","loadMore","getMessageIcon","icons","system","private","group","formatTime","time","Date","addSuffix","locale","handleMessageClick","message","read","markAsRead","$router","id","put","markAllRead","forEach","m","success","deleteMessage","$confirm","confirmButtonText","cancelButtonText","delete","index","findIndex","splice","clearAll"],"sources":["E:\\moyun-reading-platform\\frontend\\src\\views\\message\\MessageList.vue"],"sourcesContent":["<template>\r\n  <div class=\"message-list\">\r\n    <div class=\"message-header\">\r\n      <h2>消息列表</h2>\r\n      <div class=\"header-actions\">\r\n        <el-button\r\n          type=\"primary\"\r\n          link\r\n          @click=\"markAllRead\"\r\n        >\r\n          全部标为已读\r\n        </el-button>\r\n        <el-button\r\n          type=\"danger\"\r\n          link\r\n          @click=\"clearAll\"\r\n        >\r\n          清空消息\r\n        </el-button>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 消息类型筛选 -->\r\n    <div class=\"filter-bar\">\r\n      <el-radio-group v-model=\"activeType\" @change=\"handleTypeChange\">\r\n        <el-radio-button label=\"all\">全部</el-radio-button>\r\n        <el-radio-button label=\"private\">私信</el-radio-button>\r\n        <el-radio-button label=\"group\">群聊</el-radio-button>\r\n        <el-radio-button label=\"system\">系统消息</el-radio-button>\r\n      </el-radio-group>\r\n    </div>\r\n\r\n    <!-- 消息列表 -->\r\n    <div class=\"message-items\">\r\n      <div\r\n        v-for=\"message in messages\"\r\n        :key=\"message.id\"\r\n        class=\"message-item\"\r\n        :class=\"{ unread: !message.read }\"\r\n        @click=\"handleMessageClick(message)\"\r\n      >\r\n        <div class=\"message-icon\">\r\n          <el-avatar\r\n            :size=\"40\"\r\n            :src=\"message.sender?.avatar\"\r\n          >\r\n            <el-icon>\r\n              <component :is=\"getMessageIcon(message.type)\" />\r\n            </el-icon>\r\n          </el-avatar>\r\n        </div>\r\n\r\n        <div class=\"message-content\">\r\n          <div class=\"message-header\">\r\n            <span class=\"sender\">{{ message.sender?.username || '系统' }}</span>\r\n            <span class=\"time\">{{ formatTime(message.createTime) }}</span>\r\n          </div>\r\n          <div class=\"message-body\">\r\n            {{ message.content }}\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"message-actions\">\r\n          <el-button\r\n            v-if=\"!message.read\"\r\n            type=\"primary\"\r\n            link\r\n            @click.stop=\"markAsRead(message)\"\r\n          >\r\n            标为已读\r\n          </el-button>\r\n          <el-button\r\n            type=\"danger\"\r\n            link\r\n            @click.stop=\"deleteMessage(message)\"\r\n          >\r\n            删除\r\n          </el-button>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- 空状态 -->\r\n      <el-empty\r\n        v-if=\"messages.length === 0\"\r\n        description=\"暂无消息\"\r\n      />\r\n    </div>\r\n\r\n    <!-- 加载更多 -->\r\n    <div\r\n      v-if=\"hasMore\"\r\n      class=\"load-more\"\r\n    >\r\n      <el-button\r\n        :loading=\"loading\"\r\n        @click=\"loadMore\"\r\n      >\r\n        加载更多\r\n      </el-button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { Bell, ChatDotRound, User } from '@element-plus/icons-vue'\r\nimport { formatDistanceToNow } from 'date-fns'\r\nimport { zhCN } from 'date-fns/locale'\r\n\r\nexport default {\r\n  name: 'MessageList',\r\n  components: {\r\n    Bell,\r\n    ChatDotRound,\r\n    User\r\n  },\r\n  data() {\r\n    return {\r\n      messages: [],\r\n      activeType: 'all',\r\n      loading: false,\r\n      hasMore: true,\r\n      page: 1,\r\n      pageSize: 20\r\n    }\r\n  },\r\n  created() {\r\n    this.fetchMessages()\r\n  },\r\n  methods: {\r\n    async fetchMessages() {\r\n      this.loading = true\r\n      try {\r\n        const response = await this.$http.get('/api/messages', {\r\n          params: {\r\n            page: this.page,\r\n            size: this.pageSize,\r\n            type: this.activeType === 'all' ? undefined : this.activeType\r\n          }\r\n        })\r\n        if (this.page === 1) {\r\n          this.messages = response.data.items\r\n        } else {\r\n          this.messages.push(...response.data.items)\r\n        }\r\n        this.hasMore = response.data.hasMore\r\n      } catch (error) {\r\n        this.$message.error('获取消息列表失败')\r\n      } finally {\r\n        this.loading = false\r\n      }\r\n    },\r\n    handleTypeChange() {\r\n      this.page = 1\r\n      this.fetchMessages()\r\n    },\r\n    async loadMore() {\r\n      this.page++\r\n      await this.fetchMessages()\r\n    },\r\n    getMessageIcon(type) {\r\n      const icons = {\r\n        system: 'Bell',\r\n        private: 'ChatDotRound',\r\n        group: 'User'\r\n      }\r\n      return icons[type] || 'Bell'\r\n    },\r\n    formatTime(time) {\r\n      return formatDistanceToNow(new Date(time), {\r\n        addSuffix: true,\r\n        locale: zhCN\r\n      })\r\n    },\r\n    async handleMessageClick(message) {\r\n      if (!message.read) {\r\n        await this.markAsRead(message)\r\n      }\r\n      this.$router.push(`/messages/${message.id}`)\r\n    },\r\n    async markAsRead(message) {\r\n      try {\r\n        await this.$http.put(`/api/messages/${message.id}/read`)\r\n        message.read = true\r\n      } catch (error) {\r\n        this.$message.error('标记已读失败')\r\n      }\r\n    },\r\n    async markAllRead() {\r\n      try {\r\n        await this.$http.put('/api/messages/read-all')\r\n        this.messages.forEach(m => m.read = true)\r\n        this.$message.success('已全部标为已读')\r\n      } catch (error) {\r\n        this.$message.error('操作失败')\r\n      }\r\n    },\r\n    async deleteMessage(message) {\r\n      try {\r\n        await this.$confirm('确定要删除这条消息吗？', '提示', {\r\n          confirmButtonText: '确定',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        })\r\n        await this.$http.delete(`/api/messages/${message.id}`)\r\n        const index = this.messages.findIndex(m => m.id === message.id)\r\n        if (index !== -1) {\r\n          this.messages.splice(index, 1)\r\n        }\r\n      } catch (error) {\r\n        if (error !== 'cancel') {\r\n          this.$message.error('删除失败')\r\n        }\r\n      }\r\n    },\r\n    async clearAll() {\r\n      try {\r\n        await this.$confirm('确定要清空所有消息吗？', '提示', {\r\n          confirmButtonText: '确定',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        })\r\n        await this.$http.delete('/api/messages')\r\n        this.messages = []\r\n        this.$message.success('消息已清空')\r\n      } catch (error) {\r\n        if (error !== 'cancel') {\r\n          this.$message.error('清空失败')\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.message-list {\r\n  .message-header {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    margin-bottom: 20px;\r\n\r\n    h2 {\r\n      margin: 0;\r\n      font-size: 24px;\r\n      color: var(--text-color);\r\n    }\r\n\r\n    .header-actions {\r\n      display: flex;\r\n      gap: 10px;\r\n    }\r\n  }\r\n\r\n  .filter-bar {\r\n    margin-bottom: 20px;\r\n  }\r\n\r\n  .message-items {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 15px;\r\n  }\r\n\r\n  .message-item {\r\n    display: flex;\r\n    gap: 15px;\r\n    padding: 15px;\r\n    background-color: var(--background-color-light);\r\n    border-radius: 8px;\r\n    cursor: pointer;\r\n    transition: background-color 0.3s;\r\n\r\n    &:hover {\r\n      background-color: var(--background-color-hover);\r\n    }\r\n\r\n    &.unread {\r\n      background-color: var(--background-color-active);\r\n    }\r\n  }\r\n\r\n  .message-content {\r\n    flex: 1;\r\n    min-width: 0;\r\n  }\r\n\r\n  .message-header {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    margin-bottom: 5px;\r\n\r\n    .sender {\r\n      font-weight: bold;\r\n      color: var(--text-color);\r\n    }\r\n\r\n    .time {\r\n      font-size: 12px;\r\n      color: var(--text-color-secondary);\r\n    }\r\n  }\r\n\r\n  .message-body {\r\n    color: var(--text-color);\r\n    margin-bottom: 5px;\r\n  }\r\n\r\n  .message-actions {\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: center;\r\n    gap: 5px;\r\n  }\r\n\r\n  .load-more {\r\n    margin-top: 20px;\r\n    display: flex;\r\n    justify-content: center;\r\n  }\r\n}\r\n</style> "],"mappings":";;;AAwGA,SAASA,IAAI,EAAEC,YAAY,EAAEC,IAAG,QAAS,yBAAwB;AACjE,SAASC,mBAAkB,QAAS,UAAS;AAC7C,SAASC,IAAG,QAAS,iBAAgB;AAErC,eAAe;EACbC,IAAI,EAAE,aAAa;EACnBC,UAAU,EAAE;IACVN,IAAI;IACJC,YAAY;IACZC;EACF,CAAC;EACDK,IAAIA,CAAA,EAAG;IACL,OAAO;MACLC,QAAQ,EAAE,EAAE;MACZC,UAAU,EAAE,KAAK;MACjBC,OAAO,EAAE,KAAK;MACdC,OAAO,EAAE,IAAI;MACbC,IAAI,EAAE,CAAC;MACPC,QAAQ,EAAE;IACZ;EACF,CAAC;EACDC,OAAOA,CAAA,EAAG;IACR,IAAI,CAACC,aAAa,CAAC;EACrB,CAAC;EACDC,OAAO,EAAE;IACP,MAAMD,aAAaA,CAAA,EAAG;MACpB,IAAI,CAACL,OAAM,GAAI,IAAG;MAClB,IAAI;QACF,MAAMO,QAAO,GAAI,MAAM,IAAI,CAACC,KAAK,CAACC,GAAG,CAAC,eAAe,EAAE;UACrDC,MAAM,EAAE;YACNR,IAAI,EAAE,IAAI,CAACA,IAAI;YACfS,IAAI,EAAE,IAAI,CAACR,QAAQ;YACnBS,IAAI,EAAE,IAAI,CAACb,UAAS,KAAM,KAAI,GAAIc,SAAQ,GAAI,IAAI,CAACd;UACrD;QACF,CAAC;QACD,IAAI,IAAI,CAACG,IAAG,KAAM,CAAC,EAAE;UACnB,IAAI,CAACJ,QAAO,GAAIS,QAAQ,CAACV,IAAI,CAACiB,KAAI;QACpC,OAAO;UACL,IAAI,CAAChB,QAAQ,CAACiB,IAAI,CAAC,GAAGR,QAAQ,CAACV,IAAI,CAACiB,KAAK;QAC3C;QACA,IAAI,CAACb,OAAM,GAAIM,QAAQ,CAACV,IAAI,CAACI,OAAM;MACrC,EAAE,OAAOe,KAAK,EAAE;QACd,IAAI,CAACC,QAAQ,CAACD,KAAK,CAAC,UAAU;MAChC,UAAU;QACR,IAAI,CAAChB,OAAM,GAAI,KAAI;MACrB;IACF,CAAC;IACDkB,gBAAgBA,CAAA,EAAG;MACjB,IAAI,CAAChB,IAAG,GAAI;MACZ,IAAI,CAACG,aAAa,CAAC;IACrB,CAAC;IACD,MAAMc,QAAQA,CAAA,EAAG;MACf,IAAI,CAACjB,IAAI,EAAC;MACV,MAAM,IAAI,CAACG,aAAa,CAAC;IAC3B,CAAC;IACDe,cAAcA,CAACR,IAAI,EAAE;MACnB,MAAMS,KAAI,GAAI;QACZC,MAAM,EAAE,MAAM;QACdC,OAAO,EAAE,cAAc;QACvBC,KAAK,EAAE;MACT;MACA,OAAOH,KAAK,CAACT,IAAI,KAAK,MAAK;IAC7B,CAAC;IACDa,UAAUA,CAACC,IAAI,EAAE;MACf,OAAOjC,mBAAmB,CAAC,IAAIkC,IAAI,CAACD,IAAI,CAAC,EAAE;QACzCE,SAAS,EAAE,IAAI;QACfC,MAAM,EAAEnC;MACV,CAAC;IACH,CAAC;IACD,MAAMoC,kBAAkBA,CAACC,OAAO,EAAE;MAChC,IAAI,CAACA,OAAO,CAACC,IAAI,EAAE;QACjB,MAAM,IAAI,CAACC,UAAU,CAACF,OAAO;MAC/B;MACA,IAAI,CAACG,OAAO,CAACnB,IAAI,CAAC,aAAagB,OAAO,CAACI,EAAE,EAAE;IAC7C,CAAC;IACD,MAAMF,UAAUA,CAACF,OAAO,EAAE;MACxB,IAAI;QACF,MAAM,IAAI,CAACvB,KAAK,CAAC4B,GAAG,CAAC,iBAAiBL,OAAO,CAACI,EAAE,OAAO;QACvDJ,OAAO,CAACC,IAAG,GAAI,IAAG;MACpB,EAAE,OAAOhB,KAAK,EAAE;QACd,IAAI,CAACC,QAAQ,CAACD,KAAK,CAAC,QAAQ;MAC9B;IACF,CAAC;IACD,MAAMqB,WAAWA,CAAA,EAAG;MAClB,IAAI;QACF,MAAM,IAAI,CAAC7B,KAAK,CAAC4B,GAAG,CAAC,wBAAwB;QAC7C,IAAI,CAACtC,QAAQ,CAACwC,OAAO,CAACC,CAAA,IAAKA,CAAC,CAACP,IAAG,GAAI,IAAI;QACxC,IAAI,CAACf,QAAQ,CAACuB,OAAO,CAAC,SAAS;MACjC,EAAE,OAAOxB,KAAK,EAAE;QACd,IAAI,CAACC,QAAQ,CAACD,KAAK,CAAC,MAAM;MAC5B;IACF,CAAC;IACD,MAAMyB,aAAaA,CAACV,OAAO,EAAE;MAC3B,IAAI;QACF,MAAM,IAAI,CAACW,QAAQ,CAAC,aAAa,EAAE,IAAI,EAAE;UACvCC,iBAAiB,EAAE,IAAI;UACvBC,gBAAgB,EAAE,IAAI;UACtBhC,IAAI,EAAE;QACR,CAAC;QACD,MAAM,IAAI,CAACJ,KAAK,CAACqC,MAAM,CAAC,iBAAiBd,OAAO,CAACI,EAAE,EAAE;QACrD,MAAMW,KAAI,GAAI,IAAI,CAAChD,QAAQ,CAACiD,SAAS,CAACR,CAAA,IAAKA,CAAC,CAACJ,EAAC,KAAMJ,OAAO,CAACI,EAAE;QAC9D,IAAIW,KAAI,KAAM,CAAC,CAAC,EAAE;UAChB,IAAI,CAAChD,QAAQ,CAACkD,MAAM,CAACF,KAAK,EAAE,CAAC;QAC/B;MACF,EAAE,OAAO9B,KAAK,EAAE;QACd,IAAIA,KAAI,KAAM,QAAQ,EAAE;UACtB,IAAI,CAACC,QAAQ,CAACD,KAAK,CAAC,MAAM;QAC5B;MACF;IACF,CAAC;IACD,MAAMiC,QAAQA,CAAA,EAAG;MACf,IAAI;QACF,MAAM,IAAI,CAACP,QAAQ,CAAC,aAAa,EAAE,IAAI,EAAE;UACvCC,iBAAiB,EAAE,IAAI;UACvBC,gBAAgB,EAAE,IAAI;UACtBhC,IAAI,EAAE;QACR,CAAC;QACD,MAAM,IAAI,CAACJ,KAAK,CAACqC,MAAM,CAAC,eAAe;QACvC,IAAI,CAAC/C,QAAO,GAAI,EAAC;QACjB,IAAI,CAACmB,QAAQ,CAACuB,OAAO,CAAC,OAAO;MAC/B,EAAE,OAAOxB,KAAK,EAAE;QACd,IAAIA,KAAI,KAAM,QAAQ,EAAE;UACtB,IAAI,CAACC,QAAQ,CAACD,KAAK,CAAC,MAAM;QAC5B;MACF;IACF;EACF;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import { createElementVNode as _createElementVNode, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, createVNode as _createVNode, withKeys as _withKeys, renderList as _renderList, Fragment as _Fragment, createElementBlock as _createElementBlock, withModifiers as _withModifiers, resolveDirective as _resolveDirective, withDirectives as _withDirectives } from \"vue\";\nconst _hoisted_1 = {\n  class: \"book-list-container\"\n};\nconst _hoisted_2 = {\n  class: \"header\"\n};\nconst _hoisted_3 = {\n  class: \"filter-bar\"\n};\nconst _hoisted_4 = {\n  class: \"book-grid\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_divider = _resolveComponent(\"el-divider\");\n  const _component_el_input = _resolveComponent(\"el-input\");\n  const _component_el_alert = _resolveComponent(\"el-alert\");\n  const _component_book_card = _resolveComponent(\"book-card\");\n  const _component_el_empty = _resolveComponent(\"el-empty\");\n  const _component_el_pagination = _resolveComponent(\"el-pagination\");\n  const _directive_loading = _resolveDirective(\"loading\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_cache[3] || (_cache[3] = _createElementVNode(\"h2\", null, \"书库\", -1 /* HOISTED */)), _ctx.isMentor ? (_openBlock(), _createBlock(_component_el_button, {\n    key: 0,\n    type: \"primary\",\n    onClick: $options.goToRecommend\n  }, {\n    default: _withCtx(() => _cache[1] || (_cache[1] = [_createTextVNode(\" 推荐书籍 \")])),\n    _: 1 /* STABLE */,\n    __: [1]\n  }, 8 /* PROPS */, [\"onClick\"])) : _createCommentVNode(\"v-if\", true), _ctx.isMentor || $options.isStudent ? (_openBlock(), _createBlock(_component_el_button, {\n    key: 1,\n    type: \"success\",\n    onClick: $options.goToMyBooks\n  }, {\n    default: _withCtx(() => _cache[2] || (_cache[2] = [_createTextVNode(\" 我的书库 \")])),\n    _: 1 /* STABLE */,\n    __: [2]\n  }, 8 /* PROPS */, [\"onClick\"])) : _createCommentVNode(\"v-if\", true)]), _createVNode(_component_el_divider), _createElementVNode(\"div\", _hoisted_3, [_createVNode(_component_el_input, {\n    modelValue: $data.searchQuery,\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $data.searchQuery = $event),\n    placeholder: \"搜索书名或作者\",\n    clearable: \"\",\n    style: {\n      \"width\": \"300px\"\n    },\n    onClear: $options.handleSearch,\n    onKeyup: _withKeys($options.handleSearch, [\"enter\"])\n  }, {\n    append: _withCtx(() => [_createVNode(_component_el_button, {\n      icon: \"el-icon-search\",\n      onClick: $options.handleSearch\n    }, null, 8 /* PROPS */, [\"onClick\"])]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"modelValue\", \"onClear\", \"onKeyup\"])]), _withDirectives((_openBlock(), _createElementBlock(\"div\", _hoisted_4, [_ctx.error ? (_openBlock(), _createBlock(_component_el_alert, {\n    key: 0,\n    title: _ctx.error,\n    type: \"error\",\n    \"show-icon\": \"\",\n    closable: false\n  }, null, 8 /* PROPS */, [\"title\"])) : _ctx.books && _ctx.books.length > 0 ? (_openBlock(true), _createElementBlock(_Fragment, {\n    key: 1\n  }, _renderList(_ctx.books, book => {\n    return _openBlock(), _createBlock(_component_book_card, {\n      key: book.id,\n      book: book,\n      onClick: $event => $options.goToDetail(book.id)\n    }, {\n      footer: _withCtx(() => [(_ctx.isMentor || $options.isStudent) && !$options.isInMyBooks(book.id) ? (_openBlock(), _createBlock(_component_el_button, {\n        key: 0,\n        size: \"mini\",\n        type: \"success\",\n        onClick: _withModifiers($event => $options.addToMyBooks(book.id), [\"stop\"])\n      }, {\n        default: _withCtx(() => [...(_cache[4] || (_cache[4] = [_createTextVNode(\" 加入我的书库 \")]))]),\n        _: 2 /* DYNAMIC */,\n        __: [4]\n      }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"])) : _createCommentVNode(\"v-if\", true), (_ctx.isMentor || $options.isStudent) && $options.isInMyBooks(book.id) ? (_openBlock(), _createBlock(_component_el_button, {\n        key: 1,\n        size: \"mini\",\n        type: \"info\",\n        disabled: \"\"\n      }, {\n        default: _withCtx(() => [...(_cache[5] || (_cache[5] = [_createTextVNode(\" 已添加 \")]))]),\n        _: 1 /* STABLE */,\n        __: [5]\n      })) : _createCommentVNode(\"v-if\", true)]),\n      _: 2 /* DYNAMIC */\n    }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"book\", \"onClick\"]);\n  }), 128 /* KEYED_FRAGMENT */)) : (_openBlock(), _createBlock(_component_el_empty, {\n    key: 2,\n    description: \"暂无书籍\"\n  }))])), [[_directive_loading, _ctx.loading]]), $options.total > 0 ? (_openBlock(), _createBlock(_component_el_pagination, {\n    key: 0,\n    layout: \"prev, pager, next\",\n    total: $options.total,\n    \"page-size\": $data.pageSize,\n    onCurrentChange: $options.handlePageChange\n  }, null, 8 /* PROPS */, [\"total\", \"page-size\", \"onCurrentChange\"])) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_ctx","isMentor","_createBlock","_component_el_button","key","type","onClick","$options","goToRecommend","default","_withCtx","_cache","_createTextVNode","_","__","_createCommentVNode","isStudent","goToMyBooks","_createVNode","_component_el_divider","_hoisted_3","_component_el_input","modelValue","$data","searchQuery","$event","placeholder","clearable","style","onClear","handleSearch","onKeyup","_withKeys","append","icon","_hoisted_4","error","_component_el_alert","title","closable","books","length","_Fragment","_renderList","book","_component_book_card","id","goToDetail","footer","isInMyBooks","size","_withModifiers","addToMyBooks","disabled","_component_el_empty","description","loading","total","_component_el_pagination","layout","pageSize","onCurrentChange","handlePageChange"],"sources":["E:\\moyun-reading-platform\\frontend\\src\\views\\books\\BookList.vue"],"sourcesContent":["<template>\r\n    <div class=\"book-list-container\">\r\n      <div class=\"header\">\r\n        <h2>书库</h2>\r\n        <el-button \r\n          v-if=\"isMentor\" \r\n          type=\"primary\" \r\n          @click=\"goToRecommend\"\r\n        >\r\n          推荐书籍\r\n        </el-button>\r\n        <el-button \r\n          v-if=\"isMentor || isStudent\" \r\n          type=\"success\" \r\n          @click=\"goToMyBooks\"\r\n        >\r\n          我的书库\r\n        </el-button>\r\n      </div>\r\n      \r\n      <el-divider />\r\n      \r\n      <div class=\"filter-bar\">\r\n        <el-input\r\n          v-model=\"searchQuery\"\r\n          placeholder=\"搜索书名或作者\"\r\n          clearable\r\n          style=\"width: 300px\"\r\n          @clear=\"handleSearch\"\r\n          @keyup.enter=\"handleSearch\"\r\n        >\r\n          <template #append>\r\n            <el-button icon=\"el-icon-search\" @click=\"handleSearch\" />\r\n          </template>\r\n        </el-input>\r\n      </div>\r\n  \r\n      <div v-loading=\"loading\" class=\"book-grid\">\r\n        <template v-if=\"error\">\r\n          <el-alert\r\n            :title=\"error\"\r\n            type=\"error\"\r\n            show-icon\r\n            :closable=\"false\"\r\n          />\r\n        </template>\r\n        <template v-else-if=\"books && books.length > 0\">\r\n          <book-card\r\n            v-for=\"book in books\"\r\n            :key=\"book.id\"\r\n            :book=\"book\"\r\n            @click.native=\"goToDetail(book.id)\"\r\n          >\r\n            <template #footer>\r\n              <el-button \r\n                v-if=\"(isMentor || isStudent) && !isInMyBooks(book.id)\" \r\n                size=\"mini\" \r\n                type=\"success\" \r\n                @click.stop=\"addToMyBooks(book.id)\"\r\n              >\r\n                加入我的书库\r\n              </el-button>\r\n              <el-button \r\n                v-if=\"(isMentor || isStudent) && isInMyBooks(book.id)\" \r\n                size=\"mini\" \r\n                type=\"info\" \r\n                disabled\r\n              >\r\n                已添加\r\n              </el-button>\r\n            </template>\r\n          </book-card>\r\n        </template>\r\n        <template v-else>\r\n          <el-empty description=\"暂无书籍\" />\r\n        </template>\r\n      </div>\r\n  \r\n      <el-pagination\r\n        v-if=\"total > 0\"\r\n        layout=\"prev, pager, next\"\r\n        :total=\"total\"\r\n        :page-size=\"pageSize\"\r\n        @current-change=\"handlePageChange\"\r\n      />\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  import { mapState, mapGetters, mapActions } from 'vuex'\r\n  import BookCard from '@/components/BookCard.vue'\r\n  import userBooksApi from '@/api/userBooks'\r\n  \r\n  export default {\r\n    name: 'BookListView',\r\n    components: { BookCard },\r\n    data() {\r\n      return {\r\n        searchQuery: '',\r\n        page: 1,\r\n        pageSize: 12,\r\n        myBookIds: []\r\n      }\r\n    },\r\n    computed: {\r\n      ...mapState('books', ['books', 'loading', 'error']),\r\n      ...mapGetters('auth', ['isMentor', 'userRole']),\r\n      isStudent() {\r\n        return this.userRole === 'student'\r\n      },\r\n      total() {\r\n        return this.books?.length || 0\r\n      }\r\n    },\r\n    async created() {\r\n      await this.fetchBooks()\r\n      await this.fetchMyBooks()\r\n    },\r\n    methods: {\r\n      ...mapActions('books', ['fetchBooks']),\r\n      goToDetail(bookId) {\r\n        if (bookId) {\r\n          this.$router.push(`/books/${bookId}`)\r\n        }\r\n      },\r\n      goToRecommend() {\r\n        this.$router.push('/recommend')\r\n      },\r\n      goToMyBooks() {\r\n        this.$router.push('/my-books')\r\n      },\r\n      async handleSearch() {\r\n        this.page = 1\r\n        try {\r\n          await this.fetchBooks({\r\n            query: this.searchQuery,\r\n            page: this.page,\r\n            pageSize: this.pageSize\r\n          })\r\n        } catch (error) {\r\n          console.error('搜索书籍失败:', error)\r\n        }\r\n      },\r\n      async handlePageChange(page) {\r\n        this.page = page\r\n        try {\r\n          await this.fetchBooks({\r\n            query: this.searchQuery,\r\n            page: this.page,\r\n            pageSize: this.pageSize\r\n          })\r\n        } catch (error) {\r\n          console.error('切换页面失败:', error)\r\n        }\r\n      },\r\n      async fetchMyBooks() {\r\n        const userBooks = await userBooksApi.getBooks()\r\n        this.myBookIds = userBooks.map(ub => ub.book_id)\r\n      },\r\n      isInMyBooks(bookId) {\r\n        return this.myBookIds.includes(bookId)\r\n      },\r\n      async addToMyBooks(bookId) {\r\n        await userBooksApi.addBook(bookId)\r\n        this.$message.success('已加入我的书库')\r\n        await this.fetchMyBooks()\r\n      }\r\n    }\r\n  }\r\n  </script>\r\n  \r\n  <style scoped>\r\n  .book-list-container {\r\n    padding: 20px;\r\n    max-width: 1200px;\r\n    margin: 0 auto;\r\n  }\r\n  \r\n  .header {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n  }\r\n  \r\n  .filter-bar {\r\n    margin: 20px 0;\r\n  }\r\n  \r\n  .book-grid {\r\n    display: grid;\r\n    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\r\n    gap: 20px;\r\n    margin: 20px 0;\r\n  }\r\n  \r\n  .el-pagination {\r\n    margin-top: 20px;\r\n    text-align: center;\r\n  }\r\n  </style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
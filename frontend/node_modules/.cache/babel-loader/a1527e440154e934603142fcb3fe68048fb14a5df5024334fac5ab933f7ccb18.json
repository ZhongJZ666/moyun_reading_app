{"ast":null,"code":"import { createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, withKeys as _withKeys, withCtx as _withCtx, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, resolveDirective as _resolveDirective, withDirectives as _withDirectives, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"book-management\"\n};\nconst _hoisted_2 = {\n  class: \"card-header\"\n};\nconst _hoisted_3 = {\n  class: \"header-actions\"\n};\nconst _hoisted_4 = {\n  class: \"image-error\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_input = _resolveComponent(\"el-input\");\n  const _component_el_table_column = _resolveComponent(\"el-table-column\");\n  const _component_el_icon_picture = _resolveComponent(\"el-icon-picture\");\n  const _component_el_icon = _resolveComponent(\"el-icon\");\n  const _component_el_image = _resolveComponent(\"el-image\");\n  const _component_el_tag = _resolveComponent(\"el-tag\");\n  const _component_el_table = _resolveComponent(\"el-table\");\n  const _component_el_pagination = _resolveComponent(\"el-pagination\");\n  const _component_el_card = _resolveComponent(\"el-card\");\n  const _directive_loading = _resolveDirective(\"loading\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_el_card, null, {\n    header: _withCtx(() => [_createElementVNode(\"div\", _hoisted_2, [_cache[1] || (_cache[1] = _createElementVNode(\"span\", null, \"书籍管理\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_3, [_createVNode(_component_el_input, {\n      modelValue: $data.searchQuery,\n      \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $data.searchQuery = $event),\n      placeholder: \"搜索书名/作者\",\n      clearable: \"\",\n      style: {\n        \"width\": \"300px\"\n      },\n      onClear: $options.handleSearch,\n      onKeyup: _withKeys($options.handleSearch, [\"enter\"])\n    }, {\n      append: _withCtx(() => [_createVNode(_component_el_button, {\n        icon: \"el-icon-search\",\n        onClick: $options.handleSearch\n      }, null, 8 /* PROPS */, [\"onClick\"])]),\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"modelValue\", \"onClear\", \"onKeyup\"])])])]),\n    default: _withCtx(() => [_withDirectives((_openBlock(), _createBlock(_component_el_table, {\n      data: _ctx.books,\n      style: {\n        \"width\": \"100%\"\n      }\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_table_column, {\n        prop: \"title\",\n        label: \"书名\"\n      }), _createVNode(_component_el_table_column, {\n        prop: \"author\",\n        label: \"作者\"\n      }), _createVNode(_component_el_table_column, {\n        label: \"推荐人\"\n      }, {\n        default: _withCtx(({\n          row\n        }) => [_createTextVNode(_toDisplayString(row.recommender_name || '系统'), 1 /* TEXT */)]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_table_column, {\n        label: \"封面\",\n        width: \"120\"\n      }, {\n        default: _withCtx(({\n          row\n        }) => [_createVNode(_component_el_image, {\n          src: row.cover_url,\n          fit: \"cover\",\n          style: {\n            \"width\": \"60px\",\n            \"height\": \"80px\"\n          },\n          \"preview-src-list\": [row.cover_url]\n        }, {\n          error: _withCtx(() => [_createElementVNode(\"div\", _hoisted_4, [_createVNode(_component_el_icon, null, {\n            default: _withCtx(() => [_createVNode(_component_el_icon_picture)]),\n            _: 1 /* STABLE */\n          })])]),\n          _: 2 /* DYNAMIC */\n        }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"src\", \"preview-src-list\"])]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_table_column, {\n        label: \"状态\",\n        width: \"100\"\n      }, {\n        default: _withCtx(({\n          row\n        }) => [_createVNode(_component_el_tag, {\n          type: row.status === 'approved' ? 'success' : 'warning'\n        }, {\n          default: _withCtx(() => [_createTextVNode(_toDisplayString($options.formatStatus(row.status)), 1 /* TEXT */)]),\n          _: 2 /* DYNAMIC */\n        }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"type\"])]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_table_column, {\n        label: \"操作\",\n        width: \"180\"\n      }, {\n        default: _withCtx(({\n          row\n        }) => [row.status !== 'approved' ? (_openBlock(), _createBlock(_component_el_button, {\n          key: 0,\n          size: \"mini\",\n          type: \"success\",\n          onClick: $event => $options.handleApprove(row.id)\n        }, {\n          default: _withCtx(() => _cache[2] || (_cache[2] = [_createTextVNode(\" 通过 \")])),\n          _: 2 /* DYNAMIC */,\n          __: [2]\n        }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"])) : _createCommentVNode(\"v-if\", true), _createVNode(_component_el_button, {\n          size: \"mini\",\n          type: \"danger\",\n          onClick: $event => $options.handleDelete(row.id)\n        }, {\n          default: _withCtx(() => _cache[3] || (_cache[3] = [_createTextVNode(\" 删除 \")])),\n          _: 2 /* DYNAMIC */,\n          __: [3]\n        }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"])]),\n        _: 1 /* STABLE */\n      })]),\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"data\"])), [[_directive_loading, _ctx.loading]]), _createVNode(_component_el_pagination, {\n      class: \"pagination\",\n      layout: \"total, sizes, prev, pager, next\",\n      total: $options.total,\n      \"page-size\": $data.pageSize,\n      \"current-page\": $data.currentPage,\n      onSizeChange: $options.handleSizeChange,\n      onCurrentChange: $options.handlePageChange\n    }, null, 8 /* PROPS */, [\"total\", \"page-size\", \"current-page\", \"onSizeChange\", \"onCurrentChange\"])]),\n    _: 1 /* STABLE */\n  })]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createVNode","_component_el_card","header","_withCtx","_createElementVNode","_hoisted_2","_hoisted_3","_component_el_input","modelValue","$data","searchQuery","_cache","$event","placeholder","clearable","style","onClear","$options","handleSearch","onKeyup","_withKeys","append","_component_el_button","icon","onClick","_","default","_createBlock","_component_el_table","data","_ctx","books","_component_el_table_column","prop","label","row","_createTextVNode","_toDisplayString","recommender_name","width","_component_el_image","src","cover_url","fit","error","_hoisted_4","_component_el_icon","_component_el_icon_picture","_component_el_tag","type","status","formatStatus","key","size","handleApprove","id","__","_createCommentVNode","handleDelete","loading","_component_el_pagination","layout","total","pageSize","currentPage","onSizeChange","handleSizeChange","onCurrentChange","handlePageChange"],"sources":["C:\\Users\\仲佳泽\\Desktop\\大学作业\\软件工程\\moyun-reading-platform\\frontend\\src\\views\\admin\\BookManagement.vue"],"sourcesContent":["<template>\r\n    <div class=\"book-management\">\r\n      <el-card>\r\n        <template #header>\r\n          <div class=\"card-header\">\r\n            <span>书籍管理</span>\r\n            <div class=\"header-actions\">\r\n              <el-input\r\n                v-model=\"searchQuery\"\r\n                placeholder=\"搜索书名/作者\"\r\n                clearable\r\n                style=\"width: 300px\"\r\n                @clear=\"handleSearch\"\r\n                @keyup.enter=\"handleSearch\"\r\n              >\r\n                <template #append>\r\n                  <el-button icon=\"el-icon-search\" @click=\"handleSearch\" />\r\n                </template>\r\n              </el-input>\r\n            </div>\r\n          </div>\r\n        </template>\r\n  \r\n        <el-table \r\n          :data=\"books\" \r\n          v-loading=\"loading\"\r\n          style=\"width: 100%\"\r\n        >\r\n          <el-table-column prop=\"title\" label=\"书名\" />\r\n          <el-table-column prop=\"author\" label=\"作者\" />\r\n          <el-table-column label=\"推荐人\">\r\n            <template #default=\"{row}\">\r\n              {{ row.recommender_name || '系统' }}\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"封面\" width=\"120\">\r\n            <template #default=\"{row}\">\r\n              <el-image \r\n                :src=\"row.cover_url\" \r\n                fit=\"cover\" \r\n                style=\"width: 60px; height: 80px\"\r\n                :preview-src-list=\"[row.cover_url]\"\r\n              >\r\n                <template #error>\r\n                  <div class=\"image-error\">\r\n                    <el-icon><el-icon-picture /></el-icon>\r\n                  </div>\r\n                </template>\r\n              </el-image>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"状态\" width=\"100\">\r\n            <template #default=\"{row}\">\r\n              <el-tag :type=\"row.status === 'approved' ? 'success' : 'warning'\">\r\n                {{ formatStatus(row.status) }}\r\n              </el-tag>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"操作\" width=\"180\">\r\n            <template #default=\"{row}\">\r\n              <el-button \r\n                size=\"mini\" \r\n                type=\"success\"\r\n                @click=\"handleApprove(row.id)\"\r\n                v-if=\"row.status !== 'approved'\"\r\n              >\r\n                通过\r\n              </el-button>\r\n              <el-button \r\n                size=\"mini\" \r\n                type=\"danger\"\r\n                @click=\"handleDelete(row.id)\"\r\n              >\r\n                删除\r\n              </el-button>\r\n            </template>\r\n          </el-table-column>\r\n        </el-table>\r\n  \r\n        <el-pagination\r\n          class=\"pagination\"\r\n          layout=\"total, sizes, prev, pager, next\"\r\n          :total=\"total\"\r\n          :page-size=\"pageSize\"\r\n          :current-page=\"currentPage\"\r\n          @size-change=\"handleSizeChange\"\r\n          @current-change=\"handlePageChange\"\r\n        />\r\n      </el-card>\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  import { Picture as ElIconPicture } from '@element-plus/icons-vue'\r\n  import { mapState, mapActions } from 'vuex'\r\n  \r\n  export default {\r\n    name: 'BookManagement',\r\n    components: {\r\n      ElIconPicture\r\n    },\r\n    data() {\r\n      return {\r\n        searchQuery: '',\r\n        currentPage: 1,\r\n        pageSize: 10\r\n      }\r\n    },\r\n    computed: {\r\n      ...mapState('admin', ['books', 'loading']),\r\n      total() {\r\n        return this.books.length // 实际项目应从API获取\r\n      }\r\n    },\r\n    methods: {\r\n      ...mapActions('admin', ['fetchBooks', 'approveBook', 'deleteBook']),\r\n      \r\n      formatStatus(status) {\r\n        const statusMap = {\r\n          pending: '待审核',\r\n          approved: '已通过',\r\n          rejected: '已拒绝'\r\n        }\r\n        return statusMap[status] || status\r\n      },\r\n      \r\n      handleSearch() {\r\n        this.currentPage = 1\r\n        this.fetchBooks({\r\n          query: this.searchQuery,\r\n          page: this.currentPage,\r\n          pageSize: this.pageSize\r\n        })\r\n      },\r\n      \r\n      handleSizeChange(size) {\r\n        this.pageSize = size\r\n        this.fetchBooks({\r\n          query: this.searchQuery,\r\n          page: this.currentPage,\r\n          pageSize: this.pageSize\r\n        })\r\n      },\r\n      \r\n      handlePageChange(page) {\r\n        this.currentPage = page\r\n        this.fetchBooks({\r\n          query: this.searchQuery,\r\n          page: this.currentPage,\r\n          pageSize: this.pageSize\r\n        })\r\n      },\r\n      \r\n      async handleApprove(bookId) {\r\n        try {\r\n          await this.approveBook(bookId)\r\n          this.$message.success('书籍已通过审核')\r\n        } catch (error) {\r\n          this.$message.error(error.message)\r\n        }\r\n      },\r\n      \r\n      async handleDelete(bookId) {\r\n        try {\r\n          await this.$confirm('确定删除此书籍吗？', '警告', {\r\n            type: 'warning'\r\n          })\r\n          await this.deleteBook(bookId)\r\n          this.$message.success('书籍已删除')\r\n        } catch (error) {\r\n          if (error !== 'cancel') {\r\n            this.$message.error(error.message)\r\n          }\r\n        }\r\n      }\r\n    },\r\n    created() {\r\n      this.fetchBooks()\r\n    }\r\n  }\r\n  </script>\r\n  \r\n  <style scoped>\r\n  .image-error {\r\n    width: 60px;\r\n    height: 80px;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    background: #f5f7fa;\r\n    color: #c0c4cc;\r\n  }\r\n  \r\n  /* 其他样式同UserManagement */\r\n  </style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
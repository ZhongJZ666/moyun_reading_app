{"ast":null,"code":"import { mapState, mapActions } from 'vuex';\nexport default {\n  name: 'PostManagement',\n  data() {\n    return {\n      filterStatus: 'all',\n      currentPage: 1,\n      pageSize: 10\n    };\n  },\n  computed: {\n    ...mapState('admin', ['posts', 'loading']),\n    total() {\n      return this.posts.length; // 实际项目应从API获取\n    }\n  },\n  methods: {\n    ...mapActions('admin', ['fetchPosts', 'approvePost', 'rejectPost', 'deletePost']),\n    truncate(text, length) {\n      return text.length > length ? text.substring(0, length) + '...' : text;\n    },\n    formatStatus(post) {\n      if (post.report_count > 0) return '被举报';\n      const statusMap = {\n        pending: '待审核',\n        approved: '已通过',\n        rejected: '已拒绝'\n      };\n      return statusMap[post.status] || post.status;\n    },\n    getStatusTagType(post) {\n      if (post.report_count > 0) return 'danger';\n      return post.status === 'approved' ? 'success' : post.status === 'rejected' ? 'warning' : '';\n    },\n    handleFilterChange() {\n      this.currentPage = 1;\n      this.fetchPosts({\n        status: this.filterStatus === 'all' ? null : this.filterStatus,\n        page: this.currentPage,\n        pageSize: this.pageSize\n      });\n    },\n    handleSizeChange(size) {\n      this.pageSize = size;\n      this.fetchPosts({\n        status: this.filterStatus === 'all' ? null : this.filterStatus,\n        page: this.currentPage,\n        pageSize: this.pageSize\n      });\n    },\n    handlePageChange(page) {\n      this.currentPage = page;\n      this.fetchPosts({\n        status: this.filterStatus === 'all' ? null : this.filterStatus,\n        page: this.currentPage,\n        pageSize: this.pageSize\n      });\n    },\n    async handleApprove(postId) {\n      try {\n        await this.approvePost(postId);\n        this.$message.success('内容已通过审核');\n      } catch (error) {\n        this.$message.error(error.message);\n      }\n    },\n    async handleReject(postId) {\n      try {\n        await this.rejectPost(postId);\n        this.$message.success('内容已拒绝');\n      } catch (error) {\n        this.$message.error(error.message);\n      }\n    },\n    async handleDelete(postId) {\n      try {\n        await this.$confirm('确定删除此内容吗？', '警告', {\n          type: 'warning'\n        });\n        await this.deletePost(postId);\n        this.$message.success('内容已删除');\n      } catch (error) {\n        if (error !== 'cancel') {\n          this.$message.error(error.message);\n        }\n      }\n    }\n  },\n  created() {\n    this.fetchPosts();\n  }\n};","map":{"version":3,"names":["mapState","mapActions","name","data","filterStatus","currentPage","pageSize","computed","total","posts","length","methods","truncate","text","substring","formatStatus","post","report_count","statusMap","pending","approved","rejected","status","getStatusTagType","handleFilterChange","fetchPosts","page","handleSizeChange","size","handlePageChange","handleApprove","postId","approvePost","$message","success","error","message","handleReject","rejectPost","handleDelete","$confirm","type","deletePost","created"],"sources":["E:\\moyun-reading-platform\\frontend\\src\\views\\admin\\PostManagement.vue"],"sourcesContent":["<template>\r\n    <div class=\"post-management\">\r\n      <el-card>\r\n        <template #header>\r\n          <div class=\"card-header\">\r\n            <span>内容审核</span>\r\n            <el-radio-group v-model=\"filterStatus\" @change=\"handleFilterChange\">\r\n              <el-radio-button label=\"all\">全部</el-radio-button>\r\n              <el-radio-button label=\"pending\">待审核</el-radio-button>\r\n              <el-radio-button label=\"reported\">被举报</el-radio-button>\r\n            </el-radio-group>\r\n          </div>\r\n        </template>\r\n  \r\n        <el-table \r\n          :data=\"posts\" \r\n          v-loading=\"loading\"\r\n          style=\"width: 100%\"\r\n        >\r\n          <el-table-column prop=\"title\" label=\"标题\" />\r\n          <el-table-column label=\"作者\" width=\"120\">\r\n            <template #default=\"{row}\">\r\n              {{ row.author_name }}\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"内容预览\" width=\"200\">\r\n            <template #default=\"{row}\">\r\n              <el-popover\r\n                placement=\"top-start\"\r\n                width=\"300\"\r\n                trigger=\"hover\"\r\n              >\r\n                <div class=\"content-preview\">{{ row.content }}</div>\r\n                <template #reference>\r\n                  <el-button type=\"text\">{{ truncate(row.content, 20) }}</el-button>\r\n                </template>\r\n              </el-popover>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"举报次数\" width=\"100\">\r\n            <template #default=\"{row}\">\r\n              <el-tag v-if=\"row.report_count > 0\" type=\"danger\">\r\n                {{ row.report_count }}\r\n              </el-tag>\r\n              <span v-else>-</span>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"状态\" width=\"100\">\r\n            <template #default=\"{row}\">\r\n              <el-tag :type=\"getStatusTagType(row)\">\r\n                {{ formatStatus(row) }}\r\n              </el-tag>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"操作\" width=\"220\">\r\n            <template #default=\"{row}\">\r\n              <el-button \r\n                size=\"mini\" \r\n                type=\"success\"\r\n                @click=\"handleApprove(row.id)\"\r\n                v-if=\"row.status !== 'approved'\"\r\n              >\r\n                通过\r\n              </el-button>\r\n              <el-button \r\n                size=\"mini\" \r\n                type=\"warning\"\r\n                @click=\"handleReject(row.id)\"\r\n                v-if=\"row.status !== 'rejected'\"\r\n              >\r\n                拒绝\r\n              </el-button>\r\n              <el-button \r\n                size=\"mini\" \r\n                type=\"danger\"\r\n                @click=\"handleDelete(row.id)\"\r\n              >\r\n                删除\r\n              </el-button>\r\n            </template>\r\n          </el-table-column>\r\n        </el-table>\r\n  \r\n        <el-pagination\r\n          class=\"pagination\"\r\n          layout=\"total, sizes, prev, pager, next\"\r\n          :total=\"total\"\r\n          :page-size=\"pageSize\"\r\n          :current-page=\"currentPage\"\r\n          @size-change=\"handleSizeChange\"\r\n          @current-change=\"handlePageChange\"\r\n        />\r\n      </el-card>\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  import { mapState, mapActions } from 'vuex'\r\n  \r\n  export default {\r\n    name: 'PostManagement',\r\n    data() {\r\n      return {\r\n        filterStatus: 'all',\r\n        currentPage: 1,\r\n        pageSize: 10\r\n      }\r\n    },\r\n    computed: {\r\n      ...mapState('admin', ['posts', 'loading']),\r\n      total() {\r\n        return this.posts.length // 实际项目应从API获取\r\n      }\r\n    },\r\n    methods: {\r\n      ...mapActions('admin', ['fetchPosts', 'approvePost', 'rejectPost', 'deletePost']),\r\n      \r\n      truncate(text, length) {\r\n        return text.length > length \r\n          ? text.substring(0, length) + '...' \r\n          : text\r\n      },\r\n      \r\n      formatStatus(post) {\r\n        if (post.report_count > 0) return '被举报'\r\n        const statusMap = {\r\n          pending: '待审核',\r\n          approved: '已通过',\r\n          rejected: '已拒绝'\r\n        }\r\n        return statusMap[post.status] || post.status\r\n      },\r\n      \r\n      getStatusTagType(post) {\r\n        if (post.report_count > 0) return 'danger'\r\n        return post.status === 'approved' ? 'success' : \r\n               post.status === 'rejected' ? 'warning' : ''\r\n      },\r\n      \r\n      handleFilterChange() {\r\n        this.currentPage = 1\r\n        this.fetchPosts({\r\n          status: this.filterStatus === 'all' ? null : this.filterStatus,\r\n          page: this.currentPage,\r\n          pageSize: this.pageSize\r\n        })\r\n      },\r\n      \r\n      handleSizeChange(size) {\r\n        this.pageSize = size\r\n        this.fetchPosts({\r\n          status: this.filterStatus === 'all' ? null : this.filterStatus,\r\n          page: this.currentPage,\r\n          pageSize: this.pageSize\r\n        })\r\n      },\r\n      \r\n      handlePageChange(page) {\r\n        this.currentPage = page\r\n        this.fetchPosts({\r\n          status: this.filterStatus === 'all' ? null : this.filterStatus,\r\n          page: this.currentPage,\r\n          pageSize: this.pageSize\r\n        })\r\n      },\r\n      \r\n      async handleApprove(postId) {\r\n        try {\r\n          await this.approvePost(postId)\r\n          this.$message.success('内容已通过审核')\r\n        } catch (error) {\r\n          this.$message.error(error.message)\r\n        }\r\n      },\r\n      \r\n      async handleReject(postId) {\r\n        try {\r\n          await this.rejectPost(postId)\r\n          this.$message.success('内容已拒绝')\r\n        } catch (error) {\r\n          this.$message.error(error.message)\r\n        }\r\n      },\r\n      \r\n      async handleDelete(postId) {\r\n        try {\r\n          await this.$confirm('确定删除此内容吗？', '警告', {\r\n            type: 'warning'\r\n          })\r\n          await this.deletePost(postId)\r\n          this.$message.success('内容已删除')\r\n        } catch (error) {\r\n          if (error !== 'cancel') {\r\n            this.$message.error(error.message)\r\n          }\r\n        }\r\n      }\r\n    },\r\n    created() {\r\n      this.fetchPosts()\r\n    }\r\n  }\r\n  </script>\r\n  \r\n  <style scoped>\r\n  .content-preview {\r\n    max-height: 200px;\r\n    overflow-y: auto;\r\n    white-space: pre-wrap;\r\n    word-break: break-word;\r\n  }\r\n  \r\n  /* 其他样式同UserManagement */\r\n  </style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
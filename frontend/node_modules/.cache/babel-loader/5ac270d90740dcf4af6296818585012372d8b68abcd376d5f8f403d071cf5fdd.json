{"ast":null,"code":"import { resolveComponent as _resolveComponent, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, createVNode as _createVNode, withCtx as _withCtx, createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, Fragment as _Fragment, createElementBlock as _createElementBlock, resolveDirective as _resolveDirective, withDirectives as _withDirectives } from \"vue\";\nconst _hoisted_1 = {\n  class: \"book-detail-container\"\n};\nconst _hoisted_2 = {\n  class: \"book-cover\"\n};\nconst _hoisted_3 = {\n  class: \"image-error\"\n};\nconst _hoisted_4 = {\n  class: \"book-info\"\n};\nconst _hoisted_5 = {\n  class: \"author\"\n};\nconst _hoisted_6 = {\n  class: \"recommender\"\n};\nconst _hoisted_7 = {\n  class: \"description\"\n};\nconst _hoisted_8 = {\n  class: \"actions\"\n};\nconst _hoisted_9 = {\n  class: \"related-posts\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_alert = _resolveComponent(\"el-alert\");\n  const _component_Picture = _resolveComponent(\"Picture\");\n  const _component_el_icon = _resolveComponent(\"el-icon\");\n  const _component_el_image = _resolveComponent(\"el-image\");\n  const _component_el_col = _resolveComponent(\"el-col\");\n  const _component_el_divider = _resolveComponent(\"el-divider\");\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_row = _resolveComponent(\"el-row\");\n  const _component_post_list = _resolveComponent(\"post-list\");\n  const _component_el_empty = _resolveComponent(\"el-empty\");\n  const _directive_loading = _resolveDirective(\"loading\");\n  return _withDirectives((_openBlock(), _createElementBlock(\"div\", _hoisted_1, [_ctx.error ? (_openBlock(), _createBlock(_component_el_alert, {\n    key: 0,\n    title: _ctx.error,\n    type: \"error\",\n    \"show-icon\": \"\",\n    closable: false\n  }, null, 8 /* PROPS */, [\"title\"])) : $options.book ? (_openBlock(), _createElementBlock(_Fragment, {\n    key: 1\n  }, [_createVNode(_component_el_row, {\n    gutter: 20\n  }, {\n    default: _withCtx(() => [_createVNode(_component_el_col, {\n      span: 6\n    }, {\n      default: _withCtx(() => [_createElementVNode(\"div\", _hoisted_2, [_createVNode(_component_el_image, {\n        src: $options.getCoverUrl($options.book.cover_url),\n        alt: $options.book?.title || '书籍封面',\n        fit: \"cover\",\n        \"preview-src-list\": [$options.getCoverUrl($options.book.cover_url)],\n        onError: $options.handleImageError\n      }, {\n        error: _withCtx(() => [_createElementVNode(\"div\", _hoisted_3, [_createVNode(_component_el_icon, null, {\n          default: _withCtx(() => [_createVNode(_component_Picture)]),\n          _: 1 /* STABLE */\n        }), _cache[1] || (_cache[1] = _createElementVNode(\"span\", null, \"图片加载失败\", -1 /* HOISTED */))])]),\n        _: 1 /* STABLE */\n      }, 8 /* PROPS */, [\"src\", \"alt\", \"preview-src-list\", \"onError\"])])]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_col, {\n      span: 18\n    }, {\n      default: _withCtx(() => [_createElementVNode(\"div\", _hoisted_4, [_createElementVNode(\"h2\", null, _toDisplayString($options.book?.title || '未知书名'), 1 /* TEXT */), _createElementVNode(\"p\", _hoisted_5, \"作者: \" + _toDisplayString($options.book?.author || '未知作者'), 1 /* TEXT */), _createElementVNode(\"p\", _hoisted_6, \"推荐人: \" + _toDisplayString($options.book?.recommender_name || '未知推荐人'), 1 /* TEXT */), _createVNode(_component_el_divider), _createElementVNode(\"div\", _hoisted_7, [_cache[2] || (_cache[2] = _createElementVNode(\"h3\", null, \"内容简介\", -1 /* HOISTED */)), _createElementVNode(\"p\", null, _toDisplayString($options.book?.description || '暂无简介'), 1 /* TEXT */)]), _createElementVNode(\"div\", _hoisted_8, [_createVNode(_component_el_button, {\n        type: \"primary\",\n        onClick: _cache[0] || (_cache[0] = $event => $options.goToCreatePost($options.book.id))\n      }, {\n        default: _withCtx(() => _cache[3] || (_cache[3] = [_createTextVNode(\" 发表读后感 \")])),\n        _: 1 /* STABLE */,\n        __: [3]\n      })])])]),\n      _: 1 /* STABLE */\n    })]),\n    _: 1 /* STABLE */\n  }), _createVNode(_component_el_divider), _createElementVNode(\"div\", _hoisted_9, [_cache[4] || (_cache[4] = _createElementVNode(\"h3\", null, \"相关读后感\", -1 /* HOISTED */)), _createVNode(_component_post_list, {\n    posts: _ctx.posts\n  }, null, 8 /* PROPS */, [\"posts\"])])], 64 /* STABLE_FRAGMENT */)) : (_openBlock(), _createBlock(_component_el_empty, {\n    key: 2,\n    description: \"未找到书籍信息\"\n  }))])), [[_directive_loading, _ctx.loading]]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_ctx","error","_createBlock","_component_el_alert","key","title","type","closable","$options","book","_Fragment","_createVNode","_component_el_row","gutter","default","_withCtx","_component_el_col","span","_createElementVNode","_hoisted_2","_component_el_image","src","getCoverUrl","cover_url","alt","fit","onError","handleImageError","_hoisted_3","_component_el_icon","_component_Picture","_","_hoisted_4","_toDisplayString","_hoisted_5","author","_hoisted_6","recommender_name","_component_el_divider","_hoisted_7","description","_hoisted_8","_component_el_button","onClick","_cache","$event","goToCreatePost","id","_createTextVNode","__","_hoisted_9","_component_post_list","posts","_component_el_empty","loading"],"sources":["C:\\Users\\仲佳泽\\Desktop\\大学作业\\软件工程\\moyun-reading-platform\\frontend\\src\\views\\books\\BookDetail.vue"],"sourcesContent":["<template>\r\n    <div class=\"book-detail-container\" v-loading=\"loading\">\r\n      <template v-if=\"error\">\r\n        <el-alert\r\n          :title=\"error\"\r\n          type=\"error\"\r\n          show-icon\r\n          :closable=\"false\"\r\n        />\r\n      </template>\r\n      <template v-else-if=\"book\">\r\n        <el-row :gutter=\"20\">\r\n          <el-col :span=\"6\">\r\n            <div class=\"book-cover\">\r\n              <el-image \r\n                :src=\"getCoverUrl(book.cover_url)\" \r\n                :alt=\"book?.title || '书籍封面'\"\r\n                fit=\"cover\"\r\n                :preview-src-list=\"[getCoverUrl(book.cover_url)]\"\r\n                @error=\"handleImageError\"\r\n              >\r\n                <template #error>\r\n                  <div class=\"image-error\">\r\n                    <el-icon><Picture /></el-icon>\r\n                    <span>图片加载失败</span>\r\n                  </div>\r\n                </template>\r\n              </el-image>\r\n            </div>\r\n          </el-col>\r\n          <el-col :span=\"18\">\r\n            <div class=\"book-info\">\r\n              <h2>{{ book?.title || '未知书名' }}</h2>\r\n              <p class=\"author\">作者: {{ book?.author || '未知作者' }}</p>\r\n              <p class=\"recommender\">推荐人: {{ book?.recommender_name || '未知推荐人' }}</p>\r\n              \r\n              <el-divider />\r\n              \r\n              <div class=\"description\">\r\n                <h3>内容简介</h3>\r\n                <p>{{ book?.description || '暂无简介' }}</p>\r\n              </div>\r\n              \r\n              <div class=\"actions\">\r\n                <el-button \r\n                  type=\"primary\" \r\n                  @click=\"goToCreatePost(book.id)\"\r\n                >\r\n                  发表读后感\r\n                </el-button>\r\n              </div>\r\n            </div>\r\n          </el-col>\r\n        </el-row>\r\n        \r\n        <el-divider />\r\n        \r\n        <div class=\"related-posts\">\r\n          <h3>相关读后感</h3>\r\n          <post-list :posts=\"posts\" />\r\n        </div>\r\n      </template>\r\n      <template v-else>\r\n        <el-empty description=\"未找到书籍信息\" />\r\n      </template>\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  import { mapState, mapActions } from 'vuex'\r\n  import PostList from '@/components/PostList.vue'\r\n  import defaultCover from '@/assets/default-book-cover.jpg'\r\n  import { Picture } from '@element-plus/icons-vue'\r\n  \r\n  export default {\r\n    name: 'BookDetailView',\r\n    components: { \r\n      PostList,\r\n      Picture\r\n    },\r\n    data() {\r\n      return {\r\n        defaultCover,\r\n        bookId: this.$route.params.id,\r\n        imageLoadError: false\r\n      }\r\n    },\r\n    computed: {\r\n      ...mapState('books', ['currentBook', 'loading', 'error']),\r\n      ...mapState('posts', ['posts']),\r\n      book() {\r\n        return this.currentBook\r\n      }\r\n    },\r\n    async created() {\r\n      try {\r\n        await Promise.all([\r\n          this.fetchBookDetail(this.bookId),\r\n          this.fetchRelatedPosts(this.bookId)\r\n        ])\r\n      } catch (error) {\r\n        console.error('获取书籍详情失败:', error)\r\n      }\r\n    },\r\n    methods: {\r\n      ...mapActions('books', ['fetchBookDetail']),\r\n      ...mapActions('posts', ['fetchRelatedPosts']),\r\n      getCoverUrl(coverUrl) {\r\n        if (!coverUrl || this.imageLoadError) return this.defaultCover\r\n        if (coverUrl.startsWith('https://example.com/covers/')) return coverUrl\r\n        if (coverUrl.startsWith('uploads/')) return `${process.env.VUE_APP_API_BASE_URL}/${coverUrl}`\r\n        return this.defaultCover\r\n      },\r\n      handleImageError() {\r\n        this.imageLoadError = true\r\n        console.warn('图片加载失败，使用默认封面')\r\n      },\r\n      goToCreatePost(bookId) {\r\n        if (bookId) {\r\n          this.$router.push({\r\n            path: '/posts/create',\r\n            query: { bookId }\r\n          })\r\n        }\r\n      }\r\n    }\r\n  }\r\n  </script>\r\n  \r\n  <style scoped>\r\n  .book-detail-container {\r\n    padding: 20px;\r\n    max-width: 1200px;\r\n    margin: 0 auto;\r\n  }\r\n  \r\n  .book-cover {\r\n    width: 100%;\r\n    height: 300px;\r\n    overflow: hidden;\r\n    border-radius: 4px;\r\n    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);\r\n    background-color: #f5f7fa;\r\n  }\r\n  \r\n  .book-cover .el-image {\r\n    width: 100%;\r\n    height: 100%;\r\n  }\r\n  \r\n  .image-error {\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    justify-content: center;\r\n    height: 100%;\r\n    color: #909399;\r\n    font-size: 14px;\r\n    background-color: #f5f7fa;\r\n  }\r\n  \r\n  .image-error .el-icon {\r\n    font-size: 24px;\r\n    margin-bottom: 8px;\r\n  }\r\n  \r\n  .book-info h2 {\r\n    margin-top: 0;\r\n  }\r\n  \r\n  .author, .recommender {\r\n    color: #666;\r\n    margin: 5px 0;\r\n  }\r\n  \r\n  .description {\r\n    margin: 20px 0;\r\n  }\r\n  \r\n  .actions {\r\n    margin-top: 30px;\r\n  }\r\n  \r\n  .related-posts {\r\n    margin-top: 40px;\r\n  }\r\n  </style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
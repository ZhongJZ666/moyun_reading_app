{"ast":null,"code":"import { createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, withKeys as _withKeys, withCtx as _withCtx, createTextVNode as _createTextVNode, toDisplayString as _toDisplayString, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, resolveDirective as _resolveDirective, withDirectives as _withDirectives, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"user-management\"\n};\nconst _hoisted_2 = {\n  class: \"card-header\"\n};\nconst _hoisted_3 = {\n  class: \"header-actions\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_input = _resolveComponent(\"el-input\");\n  const _component_el_table_column = _resolveComponent(\"el-table-column\");\n  const _component_el_tag = _resolveComponent(\"el-tag\");\n  const _component_el_table = _resolveComponent(\"el-table\");\n  const _component_el_pagination = _resolveComponent(\"el-pagination\");\n  const _component_el_card = _resolveComponent(\"el-card\");\n  const _component_user_edit_dialog = _resolveComponent(\"user-edit-dialog\");\n  const _component_user_create_dialog = _resolveComponent(\"user-create-dialog\");\n  const _directive_loading = _resolveDirective(\"loading\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_el_card, null, {\n    header: _withCtx(() => [_createElementVNode(\"div\", _hoisted_2, [_cache[5] || (_cache[5] = _createElementVNode(\"span\", null, \"用户管理\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_3, [_createVNode(_component_el_input, {\n      modelValue: $data.searchQuery,\n      \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $data.searchQuery = $event),\n      placeholder: \"搜索用户名/邮箱\",\n      clearable: \"\",\n      style: {\n        \"width\": \"300px\"\n      },\n      onClear: $options.handleSearch,\n      onKeyup: _withKeys($options.handleSearch, [\"enter\"])\n    }, {\n      append: _withCtx(() => [_createVNode(_component_el_button, {\n        icon: \"el-icon-search\",\n        onClick: $options.handleSearch\n      }, null, 8 /* PROPS */, [\"onClick\"])]),\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"modelValue\", \"onClear\", \"onKeyup\"]), _createVNode(_component_el_button, {\n      type: \"primary\",\n      icon: \"el-icon-plus\",\n      onClick: _cache[1] || (_cache[1] = $event => $data.showCreateDialog = true)\n    }, {\n      default: _withCtx(() => _cache[4] || (_cache[4] = [_createTextVNode(\" 新增用户 \")])),\n      _: 1 /* STABLE */,\n      __: [4]\n    })])])]),\n    default: _withCtx(() => [_withDirectives((_openBlock(), _createBlock(_component_el_table, {\n      data: _ctx.users,\n      style: {\n        \"width\": \"100%\"\n      }\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_table_column, {\n        prop: \"username\",\n        label: \"用户名\"\n      }), _createVNode(_component_el_table_column, {\n        prop: \"email\",\n        label: \"邮箱\"\n      }), _createVNode(_component_el_table_column, {\n        prop: \"role\",\n        label: \"角色\"\n      }, {\n        default: _withCtx(({\n          row\n        }) => [_createVNode(_component_el_tag, {\n          type: $options.roleTagType(row.role)\n        }, {\n          default: _withCtx(() => [_createTextVNode(_toDisplayString($options.formatRole(row.role)), 1 /* TEXT */)]),\n          _: 2 /* DYNAMIC */\n        }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"type\"])]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_table_column, {\n        prop: \"created_at\",\n        label: \"注册时间\",\n        width: \"180\"\n      }, {\n        default: _withCtx(({\n          row\n        }) => [_createTextVNode(_toDisplayString($options.formatDate(row.created_at)), 1 /* TEXT */)]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_table_column, {\n        label: \"操作\",\n        width: \"180\"\n      }, {\n        default: _withCtx(({\n          row\n        }) => [_createVNode(_component_el_button, {\n          size: \"mini\",\n          onClick: $event => $options.handleEdit(row)\n        }, {\n          default: _withCtx(() => _cache[6] || (_cache[6] = [_createTextVNode(\" 编辑 \")])),\n          _: 2 /* DYNAMIC */,\n          __: [6]\n        }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"]), row.id !== $options.currentUserId ? (_openBlock(), _createBlock(_component_el_button, {\n          key: 0,\n          size: \"mini\",\n          type: \"danger\",\n          onClick: $event => $options.handleDelete(row.id)\n        }, {\n          default: _withCtx(() => _cache[7] || (_cache[7] = [_createTextVNode(\" 删除 \")])),\n          _: 2 /* DYNAMIC */,\n          __: [7]\n        }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"])) : _createCommentVNode(\"v-if\", true)]),\n        _: 1 /* STABLE */\n      })]),\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"data\"])), [[_directive_loading, _ctx.loading]]), _createVNode(_component_el_pagination, {\n      class: \"pagination\",\n      layout: \"total, sizes, prev, pager, next\",\n      total: $options.total,\n      \"page-size\": $data.pageSize,\n      \"current-page\": $data.currentPage,\n      onSizeChange: $options.handleSizeChange,\n      onCurrentChange: $options.handlePageChange\n    }, null, 8 /* PROPS */, [\"total\", \"page-size\", \"current-page\", \"onSizeChange\", \"onCurrentChange\"])]),\n    _: 1 /* STABLE */\n  }), _createCommentVNode(\" 用户编辑对话框 \"), _createVNode(_component_user_edit_dialog, {\n    modelValue: $data.showEditDialog,\n    \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => $data.showEditDialog = $event),\n    user: $data.currentUser,\n    onSuccess: $options.handleEditSuccess\n  }, null, 8 /* PROPS */, [\"modelValue\", \"user\", \"onSuccess\"]), _createCommentVNode(\" 用户创建对话框 \"), _createVNode(_component_user_create_dialog, {\n    modelValue: $data.showCreateDialog,\n    \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => $data.showCreateDialog = $event),\n    onSuccess: $options.handleCreateSuccess\n  }, null, 8 /* PROPS */, [\"modelValue\", \"onSuccess\"])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createVNode","_component_el_card","header","_withCtx","_createElementVNode","_hoisted_2","_hoisted_3","_component_el_input","modelValue","$data","searchQuery","_cache","$event","placeholder","clearable","style","onClear","$options","handleSearch","onKeyup","_withKeys","append","_component_el_button","icon","onClick","_","type","showCreateDialog","default","_createTextVNode","__","_createBlock","_component_el_table","data","_ctx","users","_component_el_table_column","prop","label","row","_component_el_tag","roleTagType","role","_toDisplayString","formatRole","width","formatDate","created_at","size","handleEdit","id","currentUserId","key","handleDelete","_createCommentVNode","loading","_component_el_pagination","layout","total","pageSize","currentPage","onSizeChange","handleSizeChange","onCurrentChange","handlePageChange","_component_user_edit_dialog","showEditDialog","user","currentUser","onSuccess","handleEditSuccess","_component_user_create_dialog","handleCreateSuccess"],"sources":["E:\\moyun-reading-platform\\frontend\\src\\views\\admin\\UserManagement.vue"],"sourcesContent":["<template>\r\n    <div class=\"user-management\">\r\n      <el-card>\r\n        <template #header>\r\n          <div class=\"card-header\">\r\n            <span>用户管理</span>\r\n            <div class=\"header-actions\">\r\n              <el-input\r\n                v-model=\"searchQuery\"\r\n                placeholder=\"搜索用户名/邮箱\"\r\n                clearable\r\n                style=\"width: 300px\"\r\n                @clear=\"handleSearch\"\r\n                @keyup.enter=\"handleSearch\"\r\n              >\r\n                <template #append>\r\n                  <el-button icon=\"el-icon-search\" @click=\"handleSearch\" />\r\n                </template>\r\n              </el-input>\r\n              <el-button \r\n                type=\"primary\" \r\n                icon=\"el-icon-plus\"\r\n                @click=\"showCreateDialog = true\"\r\n              >\r\n                新增用户\r\n              </el-button>\r\n            </div>\r\n          </div>\r\n        </template>\r\n  \r\n        <el-table \r\n          :data=\"users\" \r\n          v-loading=\"loading\"\r\n          style=\"width: 100%\"\r\n        >\r\n          <el-table-column prop=\"username\" label=\"用户名\" />\r\n          <el-table-column prop=\"email\" label=\"邮箱\" />\r\n          <el-table-column prop=\"role\" label=\"角色\">\r\n            <template #default=\"{row}\">\r\n              <el-tag :type=\"roleTagType(row.role)\">\r\n                {{ formatRole(row.role) }}\r\n              </el-tag>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column prop=\"created_at\" label=\"注册时间\" width=\"180\">\r\n            <template #default=\"{row}\">\r\n              {{ formatDate(row.created_at) }}\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"操作\" width=\"180\">\r\n            <template #default=\"{row}\">\r\n              <el-button \r\n                size=\"mini\" \r\n                @click=\"handleEdit(row)\"\r\n              >\r\n                编辑\r\n              </el-button>\r\n              <el-button \r\n                size=\"mini\" \r\n                type=\"danger\"\r\n                @click=\"handleDelete(row.id)\"\r\n                v-if=\"row.id !== currentUserId\"\r\n              >\r\n                删除\r\n              </el-button>\r\n            </template>\r\n          </el-table-column>\r\n        </el-table>\r\n  \r\n        <el-pagination\r\n          class=\"pagination\"\r\n          layout=\"total, sizes, prev, pager, next\"\r\n          :total=\"total\"\r\n          :page-size=\"pageSize\"\r\n          :current-page=\"currentPage\"\r\n          @size-change=\"handleSizeChange\"\r\n          @current-change=\"handlePageChange\"\r\n        />\r\n      </el-card>\r\n  \r\n      <!-- 用户编辑对话框 -->\r\n      <user-edit-dialog \r\n        v-model=\"showEditDialog\"\r\n        :user=\"currentUser\"\r\n        @success=\"handleEditSuccess\"\r\n      />\r\n  \r\n      <!-- 用户创建对话框 -->\r\n      <user-create-dialog \r\n        v-model=\"showCreateDialog\"\r\n        @success=\"handleCreateSuccess\"\r\n      />\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  import { format } from 'date-fns'\r\n  import { mapState, mapActions } from 'vuex'\r\n  import UserEditDialog from '@/components/admin/UserEditDialog.vue'\r\n  import UserCreateDialog from '@/components/admin/UserCreateDialog.vue'\r\n  \r\n  export default {\r\n    name: 'UserManagement',\r\n    components: {\r\n      UserEditDialog,\r\n      UserCreateDialog\r\n    },\r\n    data() {\r\n      return {\r\n        searchQuery: '',\r\n        currentPage: 1,\r\n        pageSize: 10,\r\n        showEditDialog: false,\r\n        showCreateDialog: false,\r\n        currentUser: null\r\n      }\r\n    },\r\n    computed: {\r\n      ...mapState('admin', ['users', 'loading']),\r\n      ...mapState('auth', ['user']),\r\n      total() {\r\n        return this.users.length // 实际项目应从API获取\r\n      },\r\n      currentUserId() {\r\n        return this.user?.id\r\n      }\r\n    },\r\n    methods: {\r\n      ...mapActions('admin', ['fetchUsers', 'deleteUser']),\r\n      \r\n      formatRole(role) {\r\n        const roles = {\r\n          student: '学生',\r\n          mentor: '导师',\r\n          admin: '管理员'\r\n        }\r\n        return roles[role] || role\r\n      },\r\n      \r\n      roleTagType(role) {\r\n        const types = {\r\n          student: '',\r\n          mentor: 'warning',\r\n          admin: 'danger'\r\n        }\r\n        return types[role] || ''\r\n      },\r\n      \r\n      formatDate(date) {\r\n        return format(new Date(date), 'yyyy-MM-dd HH:mm')\r\n      },\r\n      \r\n      handleSearch() {\r\n        this.currentPage = 1\r\n        this.fetchUsers({\r\n          query: this.searchQuery,\r\n          page: this.currentPage,\r\n          pageSize: this.pageSize\r\n        })\r\n      },\r\n      \r\n      handleSizeChange(size) {\r\n        this.pageSize = size\r\n        this.fetchUsers({\r\n          query: this.searchQuery,\r\n          page: this.currentPage,\r\n          pageSize: this.pageSize\r\n        })\r\n      },\r\n      \r\n      handlePageChange(page) {\r\n        this.currentPage = page\r\n        this.fetchUsers({\r\n          query: this.searchQuery,\r\n          page: this.currentPage,\r\n          pageSize: this.pageSize\r\n        })\r\n      },\r\n      \r\n      handleEdit(user) {\r\n        this.currentUser = { ...user }\r\n        this.showEditDialog = true\r\n      },\r\n      \r\n      async handleDelete(userId) {\r\n        try {\r\n          await this.$confirm('确定删除此用户吗？', '警告', {\r\n            type: 'warning'\r\n          })\r\n          await this.deleteUser(userId)\r\n          this.$message.success('用户已删除')\r\n        } catch (error) {\r\n          if (error !== 'cancel') {\r\n            this.$message.error(error.message)\r\n          }\r\n        }\r\n      },\r\n      \r\n      handleEditSuccess() {\r\n        this.showEditDialog = false\r\n        this.fetchUsers()\r\n      },\r\n      \r\n      handleCreateSuccess() {\r\n        this.showCreateDialog = false\r\n        this.fetchUsers()\r\n      }\r\n    },\r\n    created() {\r\n      this.fetchUsers()\r\n    }\r\n  }\r\n  </script>\r\n  \r\n  <style scoped>\r\n  .user-management {\r\n    padding: 20px;\r\n  }\r\n  \r\n  .card-header {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n  }\r\n  \r\n  .header-actions {\r\n    display: flex;\r\n    gap: 10px;\r\n  }\r\n  \r\n  .pagination {\r\n    margin-top: 20px;\r\n    text-align: right;\r\n  }\r\n  </style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { mapState, mapActions } from 'vuex';\nimport PostList from '@/components/post/PostList.vue';\nimport { Picture } from '@element-plus/icons-vue';\nexport default {\n  name: 'BookDetailView',\n  components: {\n    PostList,\n    Picture\n  },\n  data() {\n    return {\n      defaultCover: '/images/js.jpg',\n      bookId: this.$route.params.id,\n      imageLoadError: false\n    };\n  },\n  computed: {\n    ...mapState('books', ['currentBook', 'loading', 'error']),\n    ...mapState('posts', ['posts']),\n    book() {\n      return this.currentBook;\n    }\n  },\n  async created() {\n    try {\n      await Promise.all([this.fetchBookDetail(this.bookId), this.fetchRelatedPosts(this.bookId)]);\n    } catch (error) {\n      console.error('获取书籍详情失败:', error);\n    }\n  },\n  methods: {\n    ...mapActions('books', ['fetchBookDetail']),\n    ...mapActions('posts', ['fetchRelatedPosts']),\n    getCoverUrl(coverUrl) {\n      if (this.imageLoadError) return this.defaultCover;\n      if (coverUrl) {\n        // 远程图片\n        if (coverUrl.startsWith('http://') || coverUrl.startsWith('https://')) {\n          return coverUrl;\n        }\n        // 本地静态图片（如 public/images/xxx.jpg）\n        if (coverUrl.startsWith('/images/')) {\n          return coverUrl;\n        }\n        // 上传目录或其它相对路径\n        if (coverUrl.startsWith('uploads/') || coverUrl.includes('/covers/')) {\n          const cleanUrl = coverUrl.replace(/\\\\/g, '/');\n          return `${process.env.VUE_APP_API_BASE_URL}/${cleanUrl}`;\n        }\n      }\n      // 兜底：无 cover_url 或加载失败\n      return this.defaultCover;\n    },\n    handleImageError() {\n      this.imageLoadError = true;\n      console.warn('图片加载失败，使用默认封面');\n    },\n    goToCreatePost(bookId) {\n      if (bookId) {\n        this.$router.push({\n          path: '/posts/create',\n          query: {\n            bookId\n          }\n        });\n      }\n    },\n    goToBookContent(bookId) {\n      if (bookId) {\n        this.$router.push(`/books/content/${bookId}`);\n      }\n    }\n  }\n};","map":{"version":3,"names":["mapState","mapActions","PostList","Picture","name","components","data","defaultCover","bookId","$route","params","id","imageLoadError","computed","book","currentBook","created","Promise","all","fetchBookDetail","fetchRelatedPosts","error","console","methods","getCoverUrl","coverUrl","startsWith","includes","cleanUrl","replace","process","env","VUE_APP_API_BASE_URL","handleImageError","warn","goToCreatePost","$router","push","path","query","goToBookContent"],"sources":["E:\\moyun-reading-platform\\frontend\\src\\views\\books\\BookDetail.vue"],"sourcesContent":["<template>\r\n    <div class=\"book-detail-container\" v-loading=\"loading\">\r\n      <template v-if=\"error\">\r\n        <el-alert\r\n          :title=\"error\"\r\n          type=\"error\"\r\n          show-icon\r\n          :closable=\"false\"\r\n        />\r\n      </template>\r\n      <template v-else-if=\"book\">\r\n        <el-row :gutter=\"20\">\r\n          <el-col :span=\"6\">\r\n            <div class=\"book-cover\">\r\n              <el-image \r\n                :src=\"getCoverUrl(book.cover_url)\" \r\n                :alt=\"book?.title || '书籍封面'\"\r\n                fit=\"cover\"\r\n                :preview-src-list=\"[getCoverUrl(book.cover_url)]\"\r\n                @error=\"handleImageError\"\r\n              >\r\n                <template #error>\r\n                  <div class=\"image-error\">\r\n                    <el-icon><Picture /></el-icon>\r\n                    <span>图片加载失败</span>\r\n                  </div>\r\n                </template>\r\n              </el-image>\r\n            </div>\r\n          </el-col>\r\n          <el-col :span=\"18\">\r\n            <div class=\"book-info\">\r\n              <h2>{{ book?.title || '未知书名' }}</h2>\r\n              <p class=\"author\">作者: {{ book?.author || '未知作者' }}</p>\r\n              <p class=\"recommender\">推荐人: {{ book?.recommender_name || '未知推荐人' }}</p>\r\n              \r\n              <el-divider />\r\n              \r\n              <div class=\"description\">\r\n                <h3>内容简介</h3>\r\n                <p>{{ book?.description || '暂无简介' }}</p>\r\n              </div>\r\n              \r\n              <div class=\"actions\">\r\n                <el-button \r\n                  type=\"primary\" \r\n                  @click=\"goToCreatePost(book.id)\"\r\n                >\r\n                  发表读后感\r\n                </el-button>\r\n                <el-button \r\n                  type=\"success\" \r\n                  @click=\"goToBookContent(book.id)\"\r\n                >\r\n                  查看书籍内容\r\n                </el-button>\r\n              </div>\r\n            </div>\r\n          </el-col>\r\n        </el-row>\r\n        \r\n        <el-divider />\r\n        \r\n        <div class=\"related-posts\">\r\n          <h3>相关读后感</h3>\r\n          <post-list :posts=\"posts\" />\r\n        </div>\r\n      </template>\r\n      <template v-else>\r\n        <el-empty description=\"未找到书籍信息\" />\r\n      </template>\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  import { mapState, mapActions } from 'vuex'\r\n  import PostList from '@/components/post/PostList.vue'\r\n  import { Picture } from '@element-plus/icons-vue'\r\n  \r\n  export default {\r\n    name: 'BookDetailView',\r\n    components: { \r\n      PostList,\r\n      Picture\r\n    },\r\n    data() {\r\n      return {\r\n        defaultCover: '/images/js.jpg',\r\n        bookId: this.$route.params.id,\r\n        imageLoadError: false\r\n      }\r\n    },\r\n    computed: {\r\n      ...mapState('books', ['currentBook', 'loading', 'error']),\r\n      ...mapState('posts', ['posts']),\r\n      book() {\r\n        return this.currentBook\r\n      }\r\n    },\r\n    async created() {\r\n      try {\r\n        await Promise.all([\r\n          this.fetchBookDetail(this.bookId),\r\n          this.fetchRelatedPosts(this.bookId)\r\n        ])\r\n      } catch (error) {\r\n        console.error('获取书籍详情失败:', error)\r\n      }\r\n    },\r\n    methods: {\r\n      ...mapActions('books', ['fetchBookDetail']),\r\n      ...mapActions('posts', ['fetchRelatedPosts']),\r\n      getCoverUrl(coverUrl) {\r\n        if (this.imageLoadError) return this.defaultCover\r\n        if (coverUrl) {\r\n          // 远程图片\r\n          if (coverUrl.startsWith('http://') || coverUrl.startsWith('https://')) {\r\n            return coverUrl\r\n          }\r\n          // 本地静态图片（如 public/images/xxx.jpg）\r\n          if (coverUrl.startsWith('/images/')) {\r\n            return coverUrl\r\n          }\r\n          // 上传目录或其它相对路径\r\n          if (coverUrl.startsWith('uploads/') || coverUrl.includes('/covers/')) {\r\n            const cleanUrl = coverUrl.replace(/\\\\/g, '/')\r\n            return `${process.env.VUE_APP_API_BASE_URL}/${cleanUrl}`\r\n          }\r\n        }\r\n        // 兜底：无 cover_url 或加载失败\r\n        return this.defaultCover\r\n      },\r\n      handleImageError() {\r\n        this.imageLoadError = true\r\n        console.warn('图片加载失败，使用默认封面')\r\n      },\r\n      goToCreatePost(bookId) {\r\n        if (bookId) {\r\n          this.$router.push({\r\n            path: '/posts/create',\r\n            query: { bookId }\r\n          })\r\n        }\r\n      },\r\n      goToBookContent(bookId) {\r\n        if (bookId) {\r\n          this.$router.push(`/books/content/${bookId}`)\r\n        }\r\n      }\r\n    }\r\n  }\r\n  </script>\r\n  \r\n  <style scoped>\r\n  .book-detail-container {\r\n    padding: 20px;\r\n    max-width: 1200px;\r\n    margin: 0 auto;\r\n  }\r\n  \r\n  .book-cover {\r\n    width: 100%;\r\n    height: 300px;\r\n    overflow: hidden;\r\n    border-radius: 4px;\r\n    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);\r\n    background-color: #f5f7fa;\r\n  }\r\n  \r\n  .book-cover .el-image {\r\n    width: 100%;\r\n    height: 100%;\r\n  }\r\n  \r\n  .image-error {\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    justify-content: center;\r\n    height: 100%;\r\n    color: #909399;\r\n    font-size: 14px;\r\n    background-color: #f5f7fa;\r\n  }\r\n  \r\n  .image-error .el-icon {\r\n    font-size: 24px;\r\n    margin-bottom: 8px;\r\n  }\r\n  \r\n  .book-info h2 {\r\n    margin-top: 0;\r\n  }\r\n  \r\n  .author, .recommender {\r\n    color: #666;\r\n    margin: 5px 0;\r\n  }\r\n  \r\n  .description {\r\n    margin: 20px 0;\r\n  }\r\n  \r\n  .actions {\r\n    margin-top: 30px;\r\n  }\r\n  \r\n  .related-posts {\r\n    margin-top: 40px;\r\n  }\r\n  </style>"],"mappings":";AA2EE,SAASA,QAAQ,EAAEC,UAAS,QAAS,MAAK;AAC1C,OAAOC,QAAO,MAAO,gCAA+B;AACpD,SAASC,OAAM,QAAS,yBAAwB;AAEhD,eAAe;EACbC,IAAI,EAAE,gBAAgB;EACtBC,UAAU,EAAE;IACVH,QAAQ;IACRC;EACF,CAAC;EACDG,IAAIA,CAAA,EAAG;IACL,OAAO;MACLC,YAAY,EAAE,gBAAgB;MAC9BC,MAAM,EAAE,IAAI,CAACC,MAAM,CAACC,MAAM,CAACC,EAAE;MAC7BC,cAAc,EAAE;IAClB;EACF,CAAC;EACDC,QAAQ,EAAE;IACR,GAAGb,QAAQ,CAAC,OAAO,EAAE,CAAC,aAAa,EAAE,SAAS,EAAE,OAAO,CAAC,CAAC;IACzD,GAAGA,QAAQ,CAAC,OAAO,EAAE,CAAC,OAAO,CAAC,CAAC;IAC/Bc,IAAIA,CAAA,EAAG;MACL,OAAO,IAAI,CAACC,WAAU;IACxB;EACF,CAAC;EACD,MAAMC,OAAOA,CAAA,EAAG;IACd,IAAI;MACF,MAAMC,OAAO,CAACC,GAAG,CAAC,CAChB,IAAI,CAACC,eAAe,CAAC,IAAI,CAACX,MAAM,CAAC,EACjC,IAAI,CAACY,iBAAiB,CAAC,IAAI,CAACZ,MAAM,EACnC;IACH,EAAE,OAAOa,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,WAAW,EAAEA,KAAK;IAClC;EACF,CAAC;EACDE,OAAO,EAAE;IACP,GAAGtB,UAAU,CAAC,OAAO,EAAE,CAAC,iBAAiB,CAAC,CAAC;IAC3C,GAAGA,UAAU,CAAC,OAAO,EAAE,CAAC,mBAAmB,CAAC,CAAC;IAC7CuB,WAAWA,CAACC,QAAQ,EAAE;MACpB,IAAI,IAAI,CAACb,cAAc,EAAE,OAAO,IAAI,CAACL,YAAW;MAChD,IAAIkB,QAAQ,EAAE;QACZ;QACA,IAAIA,QAAQ,CAACC,UAAU,CAAC,SAAS,KAAKD,QAAQ,CAACC,UAAU,CAAC,UAAU,CAAC,EAAE;UACrE,OAAOD,QAAO;QAChB;QACA;QACA,IAAIA,QAAQ,CAACC,UAAU,CAAC,UAAU,CAAC,EAAE;UACnC,OAAOD,QAAO;QAChB;QACA;QACA,IAAIA,QAAQ,CAACC,UAAU,CAAC,UAAU,KAAKD,QAAQ,CAACE,QAAQ,CAAC,UAAU,CAAC,EAAE;UACpE,MAAMC,QAAO,GAAIH,QAAQ,CAACI,OAAO,CAAC,KAAK,EAAE,GAAG;UAC5C,OAAO,GAAGC,OAAO,CAACC,GAAG,CAACC,oBAAoB,IAAIJ,QAAQ,EAAC;QACzD;MACF;MACA;MACA,OAAO,IAAI,CAACrB,YAAW;IACzB,CAAC;IACD0B,gBAAgBA,CAAA,EAAG;MACjB,IAAI,CAACrB,cAAa,GAAI,IAAG;MACzBU,OAAO,CAACY,IAAI,CAAC,eAAe;IAC9B,CAAC;IACDC,cAAcA,CAAC3B,MAAM,EAAE;MACrB,IAAIA,MAAM,EAAE;QACV,IAAI,CAAC4B,OAAO,CAACC,IAAI,CAAC;UAChBC,IAAI,EAAE,eAAe;UACrBC,KAAK,EAAE;YAAE/B;UAAO;QAClB,CAAC;MACH;IACF,CAAC;IACDgC,eAAeA,CAAChC,MAAM,EAAE;MACtB,IAAIA,MAAM,EAAE;QACV,IAAI,CAAC4B,OAAO,CAACC,IAAI,CAAC,kBAAkB7B,MAAM,EAAE;MAC9C;IACF;EACF;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
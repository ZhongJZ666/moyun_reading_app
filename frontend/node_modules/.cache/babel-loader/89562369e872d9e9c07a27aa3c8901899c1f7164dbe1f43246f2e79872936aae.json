{"ast":null,"code":"import { format } from 'date-fns';\nimport { mapState, mapActions } from 'vuex';\nimport UserEditDialog from '@/components/admin/UserEditDialog.vue';\nimport UserCreateDialog from '@/components/admin/UserCreateDialog.vue';\nexport default {\n  name: 'UserManagement',\n  components: {\n    UserEditDialog,\n    UserCreateDialog\n  },\n  data() {\n    return {\n      searchQuery: '',\n      currentPage: 1,\n      pageSize: 10,\n      showEditDialog: false,\n      showCreateDialog: false,\n      currentUser: null\n    };\n  },\n  computed: {\n    ...mapState('admin', ['users', 'loading']),\n    ...mapState('auth', ['user']),\n    total() {\n      return this.users.length; // 实际项目应从API获取\n    },\n    currentUserId() {\n      return this.user?.id;\n    }\n  },\n  methods: {\n    ...mapActions('admin', ['fetchUsers', 'deleteUser']),\n    formatRole(role) {\n      const roles = {\n        student: '学生',\n        mentor: '导师',\n        admin: '管理员'\n      };\n      return roles[role] || role;\n    },\n    roleTagType(role) {\n      const types = {\n        student: '',\n        mentor: 'warning',\n        admin: 'danger'\n      };\n      return types[role] || '';\n    },\n    formatDate(date) {\n      return format(new Date(date), 'yyyy-MM-dd HH:mm');\n    },\n    handleSearch() {\n      this.currentPage = 1;\n      this.fetchUsers({\n        query: this.searchQuery,\n        page: this.currentPage,\n        pageSize: this.pageSize\n      });\n    },\n    handleSizeChange(size) {\n      this.pageSize = size;\n      this.fetchUsers({\n        query: this.searchQuery,\n        page: this.currentPage,\n        pageSize: this.pageSize\n      });\n    },\n    handlePageChange(page) {\n      this.currentPage = page;\n      this.fetchUsers({\n        query: this.searchQuery,\n        page: this.currentPage,\n        pageSize: this.pageSize\n      });\n    },\n    handleEdit(user) {\n      this.currentUser = {\n        ...user\n      };\n      this.showEditDialog = true;\n    },\n    async handleDelete(userId) {\n      try {\n        await this.$confirm('确定删除此用户吗？', '警告', {\n          type: 'warning'\n        });\n        await this.deleteUser(userId);\n        this.$message.success('用户已删除');\n      } catch (error) {\n        if (error !== 'cancel') {\n          this.$message.error(error.message);\n        }\n      }\n    },\n    handleEditSuccess() {\n      this.showEditDialog = false;\n      this.fetchUsers();\n    },\n    handleCreateSuccess() {\n      this.showCreateDialog = false;\n      this.fetchUsers();\n    }\n  },\n  created() {\n    this.fetchUsers();\n  }\n};","map":{"version":3,"names":["format","mapState","mapActions","UserEditDialog","UserCreateDialog","name","components","data","searchQuery","currentPage","pageSize","showEditDialog","showCreateDialog","currentUser","computed","total","users","length","currentUserId","user","id","methods","formatRole","role","roles","student","mentor","admin","roleTagType","types","formatDate","date","Date","handleSearch","fetchUsers","query","page","handleSizeChange","size","handlePageChange","handleEdit","handleDelete","userId","$confirm","type","deleteUser","$message","success","error","message","handleEditSuccess","handleCreateSuccess","created"],"sources":["E:\\moyun-reading-platform\\moyun-reading-platform\\frontend\\src\\views\\admin\\UserManagement.vue"],"sourcesContent":["<template>\r\n    <div class=\"user-management\">\r\n      <el-card>\r\n        <template #header>\r\n          <div class=\"card-header\">\r\n            <span>用户管理</span>\r\n            <div class=\"header-actions\">\r\n              <el-input\r\n                v-model=\"searchQuery\"\r\n                placeholder=\"搜索用户名/邮箱\"\r\n                clearable\r\n                style=\"width: 300px\"\r\n                @clear=\"handleSearch\"\r\n                @keyup.enter=\"handleSearch\"\r\n              >\r\n                <template #append>\r\n                  <el-button icon=\"el-icon-search\" @click=\"handleSearch\" />\r\n                </template>\r\n              </el-input>\r\n              <el-button \r\n                type=\"primary\" \r\n                icon=\"el-icon-plus\"\r\n                @click=\"showCreateDialog = true\"\r\n              >\r\n                新增用户\r\n              </el-button>\r\n            </div>\r\n          </div>\r\n        </template>\r\n  \r\n        <el-table \r\n          :data=\"users\" \r\n          v-loading=\"loading\"\r\n          style=\"width: 100%\"\r\n        >\r\n          <el-table-column prop=\"username\" label=\"用户名\" />\r\n          <el-table-column prop=\"email\" label=\"邮箱\" />\r\n          <el-table-column prop=\"role\" label=\"角色\">\r\n            <template #default=\"{row}\">\r\n              <el-tag :type=\"roleTagType(row.role)\">\r\n                {{ formatRole(row.role) }}\r\n              </el-tag>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column prop=\"created_at\" label=\"注册时间\" width=\"180\">\r\n            <template #default=\"{row}\">\r\n              {{ formatDate(row.created_at) }}\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"操作\" width=\"180\">\r\n            <template #default=\"{row}\">\r\n              <el-button \r\n                size=\"mini\" \r\n                @click=\"handleEdit(row)\"\r\n              >\r\n                编辑\r\n              </el-button>\r\n              <el-button \r\n                size=\"mini\" \r\n                type=\"danger\"\r\n                @click=\"handleDelete(row.id)\"\r\n                v-if=\"row.id !== currentUserId\"\r\n              >\r\n                删除\r\n              </el-button>\r\n            </template>\r\n          </el-table-column>\r\n        </el-table>\r\n  \r\n        <el-pagination\r\n          class=\"pagination\"\r\n          layout=\"total, sizes, prev, pager, next\"\r\n          :total=\"total\"\r\n          :page-size=\"pageSize\"\r\n          :current-page=\"currentPage\"\r\n          @size-change=\"handleSizeChange\"\r\n          @current-change=\"handlePageChange\"\r\n        />\r\n      </el-card>\r\n  \r\n      <!-- 用户编辑对话框 -->\r\n      <user-edit-dialog \r\n        v-model=\"showEditDialog\"\r\n        :user=\"currentUser\"\r\n        @success=\"handleEditSuccess\"\r\n      />\r\n  \r\n      <!-- 用户创建对话框 -->\r\n      <user-create-dialog \r\n        v-model=\"showCreateDialog\"\r\n        @success=\"handleCreateSuccess\"\r\n      />\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  import { format } from 'date-fns'\r\n  import { mapState, mapActions } from 'vuex'\r\n  import UserEditDialog from '@/components/admin/UserEditDialog.vue'\r\n  import UserCreateDialog from '@/components/admin/UserCreateDialog.vue'\r\n  \r\n  export default {\r\n    name: 'UserManagement',\r\n    components: {\r\n      UserEditDialog,\r\n      UserCreateDialog\r\n    },\r\n    data() {\r\n      return {\r\n        searchQuery: '',\r\n        currentPage: 1,\r\n        pageSize: 10,\r\n        showEditDialog: false,\r\n        showCreateDialog: false,\r\n        currentUser: null\r\n      }\r\n    },\r\n    computed: {\r\n      ...mapState('admin', ['users', 'loading']),\r\n      ...mapState('auth', ['user']),\r\n      total() {\r\n        return this.users.length // 实际项目应从API获取\r\n      },\r\n      currentUserId() {\r\n        return this.user?.id\r\n      }\r\n    },\r\n    methods: {\r\n      ...mapActions('admin', ['fetchUsers', 'deleteUser']),\r\n      \r\n      formatRole(role) {\r\n        const roles = {\r\n          student: '学生',\r\n          mentor: '导师',\r\n          admin: '管理员'\r\n        }\r\n        return roles[role] || role\r\n      },\r\n      \r\n      roleTagType(role) {\r\n        const types = {\r\n          student: '',\r\n          mentor: 'warning',\r\n          admin: 'danger'\r\n        }\r\n        return types[role] || ''\r\n      },\r\n      \r\n      formatDate(date) {\r\n        return format(new Date(date), 'yyyy-MM-dd HH:mm')\r\n      },\r\n      \r\n      handleSearch() {\r\n        this.currentPage = 1\r\n        this.fetchUsers({\r\n          query: this.searchQuery,\r\n          page: this.currentPage,\r\n          pageSize: this.pageSize\r\n        })\r\n      },\r\n      \r\n      handleSizeChange(size) {\r\n        this.pageSize = size\r\n        this.fetchUsers({\r\n          query: this.searchQuery,\r\n          page: this.currentPage,\r\n          pageSize: this.pageSize\r\n        })\r\n      },\r\n      \r\n      handlePageChange(page) {\r\n        this.currentPage = page\r\n        this.fetchUsers({\r\n          query: this.searchQuery,\r\n          page: this.currentPage,\r\n          pageSize: this.pageSize\r\n        })\r\n      },\r\n      \r\n      handleEdit(user) {\r\n        this.currentUser = { ...user }\r\n        this.showEditDialog = true\r\n      },\r\n      \r\n      async handleDelete(userId) {\r\n        try {\r\n          await this.$confirm('确定删除此用户吗？', '警告', {\r\n            type: 'warning'\r\n          })\r\n          await this.deleteUser(userId)\r\n          this.$message.success('用户已删除')\r\n        } catch (error) {\r\n          if (error !== 'cancel') {\r\n            this.$message.error(error.message)\r\n          }\r\n        }\r\n      },\r\n      \r\n      handleEditSuccess() {\r\n        this.showEditDialog = false\r\n        this.fetchUsers()\r\n      },\r\n      \r\n      handleCreateSuccess() {\r\n        this.showCreateDialog = false\r\n        this.fetchUsers()\r\n      }\r\n    },\r\n    created() {\r\n      this.fetchUsers()\r\n    }\r\n  }\r\n  </script>\r\n  \r\n  <style scoped>\r\n  .user-management {\r\n    padding: 20px;\r\n  }\r\n  \r\n  .card-header {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n  }\r\n  \r\n  .header-actions {\r\n    display: flex;\r\n    gap: 10px;\r\n  }\r\n  \r\n  .pagination {\r\n    margin-top: 20px;\r\n    text-align: right;\r\n  }\r\n  </style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
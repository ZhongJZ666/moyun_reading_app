{"ast":null,"code":"import \"core-js/modules/web.dom-exception.stack.js\";\nimport request from '@/utils/request';\nimport { getAuthHeader, clearAuthData, setAuthData } from './utils';\nclass AuthAPI {\n  // 用户注册\n  static async register(userData) {\n    return request({\n      url: '/auth/register',\n      method: 'post',\n      data: userData\n    });\n  }\n\n  // 用户登录\n  static async login(username, password) {\n    try {\n      const response = await request({\n        url: '/auth/login',\n        method: 'post',\n        data: {\n          username,\n          password\n        }\n      });\n      if (response.token) {\n        setAuthData(response.token);\n        // 解析并返回用户信息\n        return this._getUserFromToken(response.token);\n      }\n      return response;\n    } catch (error) {\n      clearAuthData();\n      throw error;\n    }\n  }\n\n  // 用户登出\n  static async logout() {\n    try {\n      await request({\n        url: '/auth/logout',\n        method: 'post'\n      });\n    } finally {\n      clearAuthData();\n    }\n  }\n\n  // 获取当前用户信息\n  static async getCurrentUser() {\n    try {\n      return await request({\n        url: '/users/me',\n        method: 'get'\n      });\n    } catch (error) {\n      if (error.response?.status === 401) {\n        clearAuthData();\n      }\n      throw error;\n    }\n  }\n\n  // 更新用户信息\n  static async updateProfile(data) {\n    return request({\n      url: '/users/me',\n      method: 'put',\n      data\n    });\n  }\n\n  // 获取导师的学生列表\n  static async getStudents() {\n    return request({\n      url: '/users/students',\n      method: 'get'\n    });\n  }\n\n  // 获取所有用户（仅管理员）\n  static async getAllUsers() {\n    return request({\n      url: '/users',\n      method: 'get'\n    });\n  }\n\n  // 删除用户（仅管理员）\n  static async deleteUser(userId) {\n    return request({\n      url: `/users/${userId}`,\n      method: 'delete'\n    });\n  }\n\n  // 从JWT解析用户信息\n  static _getUserFromToken(token) {\n    try {\n      const base64Payload = token.split('.')[1];\n      const payload = JSON.parse(atob(base64Payload));\n      return {\n        id: payload.id,\n        username: payload.username,\n        role: payload.role\n      };\n    } catch (error) {\n      console.error('解析token失败:', error);\n      return null;\n    }\n  }\n\n  // 统一错误处理\n  static _handleError(error) {\n    if (error.response) {\n      // 后端返回的业务错误\n      return new Error(error.response.data.message || '请求失败');\n    } else {\n      // 网络或系统错误\n      return new Error('网络连接异常，请稍后重试');\n    }\n  }\n}\nexport default AuthAPI;","map":{"version":3,"names":["request","getAuthHeader","clearAuthData","setAuthData","AuthAPI","register","userData","url","method","data","login","username","password","response","token","_getUserFromToken","error","logout","getCurrentUser","status","updateProfile","getStudents","getAllUsers","deleteUser","userId","base64Payload","split","payload","JSON","parse","atob","id","role","console","_handleError","Error","message"],"sources":["C:/Users/仲佳泽/Desktop/大学作业/软件工程/moyun-reading-platform/frontend/src/api/auth.js"],"sourcesContent":["import request from '@/utils/request'\r\nimport { getAuthHeader, clearAuthData, setAuthData } from './utils';\r\n\r\nclass AuthAPI {\r\n  // 用户注册\r\n  static async register(userData) {\r\n    return request({\r\n      url: '/auth/register',\r\n      method: 'post',\r\n      data: userData\r\n    })\r\n  }\r\n\r\n  // 用户登录\r\n  static async login(username, password) {\r\n    try {\r\n      const response = await request({\r\n        url: '/auth/login',\r\n        method: 'post',\r\n        data: { username, password }\r\n      })\r\n      \r\n      if (response.token) {\r\n        setAuthData(response.token)\r\n        // 解析并返回用户信息\r\n        return this._getUserFromToken(response.token)\r\n      }\r\n      return response\r\n    } catch (error) {\r\n      clearAuthData()\r\n      throw error\r\n    }\r\n  }\r\n\r\n  // 用户登出\r\n  static async logout() {\r\n    try {\r\n      await request({\r\n        url: '/auth/logout',\r\n        method: 'post'\r\n      })\r\n    } finally {\r\n      clearAuthData()\r\n    }\r\n  }\r\n\r\n  // 获取当前用户信息\r\n  static async getCurrentUser() {\r\n    try {\r\n      return await request({\r\n        url: '/users/me',\r\n        method: 'get'\r\n      })\r\n    } catch (error) {\r\n      if (error.response?.status === 401) {\r\n        clearAuthData()\r\n      }\r\n      throw error\r\n    }\r\n  }\r\n\r\n  // 更新用户信息\r\n  static async updateProfile(data) {\r\n    return request({\r\n      url: '/users/me',\r\n      method: 'put',\r\n      data\r\n    })\r\n  }\r\n\r\n  // 获取导师的学生列表\r\n  static async getStudents() {\r\n    return request({\r\n      url: '/users/students',\r\n      method: 'get'\r\n    })\r\n  }\r\n\r\n  // 获取所有用户（仅管理员）\r\n  static async getAllUsers() {\r\n    return request({\r\n      url: '/users',\r\n      method: 'get'\r\n    })\r\n  }\r\n\r\n  // 删除用户（仅管理员）\r\n  static async deleteUser(userId) {\r\n    return request({\r\n      url: `/users/${userId}`,\r\n      method: 'delete'\r\n    })\r\n  }\r\n\r\n  // 从JWT解析用户信息\r\n  static _getUserFromToken(token) {\r\n    try {\r\n      const base64Payload = token.split('.')[1]\r\n      const payload = JSON.parse(atob(base64Payload))\r\n      return {\r\n        id: payload.id,\r\n        username: payload.username,\r\n        role: payload.role\r\n      }\r\n    } catch (error) {\r\n      console.error('解析token失败:', error)\r\n      return null\r\n    }\r\n  }\r\n\r\n  // 统一错误处理\r\n  static _handleError(error) {\r\n    if (error.response) {\r\n      // 后端返回的业务错误\r\n      return new Error(error.response.data.message || '请求失败');\r\n    } else {\r\n      // 网络或系统错误\r\n      return new Error('网络连接异常，请稍后重试');\r\n    }\r\n  }\r\n}\r\n\r\nexport default AuthAPI;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
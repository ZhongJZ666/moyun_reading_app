{"ast":null,"code":"import { Picture as ElIconPicture } from '@element-plus/icons-vue';\nimport { mapState, mapActions } from 'vuex';\nexport default {\n  name: 'BookManagement',\n  components: {\n    ElIconPicture\n  },\n  data() {\n    return {\n      searchQuery: '',\n      currentPage: 1,\n      pageSize: 10\n    };\n  },\n  computed: {\n    ...mapState('admin', ['books', 'loading']),\n    total() {\n      return this.books.length; // 实际项目应从API获取\n    }\n  },\n  methods: {\n    ...mapActions('admin', ['fetchBooks', 'approveBook', 'deleteBook']),\n    formatStatus(status) {\n      const statusMap = {\n        pending: '待审核',\n        approved: '已通过',\n        rejected: '已拒绝'\n      };\n      return statusMap[status] || status;\n    },\n    handleSearch() {\n      this.currentPage = 1;\n      this.fetchBooks({\n        query: this.searchQuery,\n        page: this.currentPage,\n        pageSize: this.pageSize\n      });\n    },\n    handleSizeChange(size) {\n      this.pageSize = size;\n      this.fetchBooks({\n        query: this.searchQuery,\n        page: this.currentPage,\n        pageSize: this.pageSize\n      });\n    },\n    handlePageChange(page) {\n      this.currentPage = page;\n      this.fetchBooks({\n        query: this.searchQuery,\n        page: this.currentPage,\n        pageSize: this.pageSize\n      });\n    },\n    async handleApprove(bookId) {\n      try {\n        await this.approveBook(bookId);\n        this.$message.success('书籍已通过审核');\n      } catch (error) {\n        this.$message.error(error.message);\n      }\n    },\n    async handleDelete(bookId) {\n      try {\n        await this.$confirm('确定删除此书籍吗？', '警告', {\n          type: 'warning'\n        });\n        await this.deleteBook(bookId);\n        this.$message.success('书籍已删除');\n      } catch (error) {\n        if (error !== 'cancel') {\n          this.$message.error(error.message);\n        }\n      }\n    }\n  },\n  created() {\n    this.fetchBooks();\n  }\n};","map":{"version":3,"names":["Picture","ElIconPicture","mapState","mapActions","name","components","data","searchQuery","currentPage","pageSize","computed","total","books","length","methods","formatStatus","status","statusMap","pending","approved","rejected","handleSearch","fetchBooks","query","page","handleSizeChange","size","handlePageChange","handleApprove","bookId","approveBook","$message","success","error","message","handleDelete","$confirm","type","deleteBook","created"],"sources":["E:\\moyun-reading-platform\\frontend\\src\\views\\admin\\BookManagement.vue"],"sourcesContent":["<template>\r\n    <div class=\"book-management\">\r\n      <el-card>\r\n        <template #header>\r\n          <div class=\"card-header\">\r\n            <span>书籍管理</span>\r\n            <div class=\"header-actions\">\r\n              <el-input\r\n                v-model=\"searchQuery\"\r\n                placeholder=\"搜索书名/作者\"\r\n                clearable\r\n                style=\"width: 300px\"\r\n                @clear=\"handleSearch\"\r\n                @keyup.enter=\"handleSearch\"\r\n              >\r\n                <template #append>\r\n                  <el-button icon=\"el-icon-search\" @click=\"handleSearch\" />\r\n                </template>\r\n              </el-input>\r\n            </div>\r\n          </div>\r\n        </template>\r\n  \r\n        <el-table \r\n          :data=\"books\" \r\n          v-loading=\"loading\"\r\n          style=\"width: 100%\"\r\n        >\r\n          <el-table-column prop=\"title\" label=\"书名\" />\r\n          <el-table-column prop=\"author\" label=\"作者\" />\r\n          <el-table-column label=\"推荐人\">\r\n            <template #default=\"{row}\">\r\n              {{ row.recommender_name || '系统' }}\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"封面\" width=\"120\">\r\n            <template #default=\"{row}\">\r\n              <el-image \r\n                :src=\"row.cover_url\" \r\n                fit=\"cover\" \r\n                style=\"width: 60px; height: 80px\"\r\n                :preview-src-list=\"[row.cover_url]\"\r\n              >\r\n                <template #error>\r\n                  <div class=\"image-error\">\r\n                    <el-icon><el-icon-picture /></el-icon>\r\n                  </div>\r\n                </template>\r\n              </el-image>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"状态\" width=\"100\">\r\n            <template #default=\"{row}\">\r\n              <el-tag :type=\"row.status === 'approved' ? 'success' : 'warning'\">\r\n                {{ formatStatus(row.status) }}\r\n              </el-tag>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"操作\" width=\"180\">\r\n            <template #default=\"{row}\">\r\n              <el-button \r\n                size=\"mini\" \r\n                type=\"success\"\r\n                @click=\"handleApprove(row.id)\"\r\n                v-if=\"row.status !== 'approved'\"\r\n              >\r\n                通过\r\n              </el-button>\r\n              <el-button \r\n                size=\"mini\" \r\n                type=\"danger\"\r\n                @click=\"handleDelete(row.id)\"\r\n              >\r\n                删除\r\n              </el-button>\r\n            </template>\r\n          </el-table-column>\r\n        </el-table>\r\n  \r\n        <el-pagination\r\n          class=\"pagination\"\r\n          layout=\"total, sizes, prev, pager, next\"\r\n          :total=\"total\"\r\n          :page-size=\"pageSize\"\r\n          :current-page=\"currentPage\"\r\n          @size-change=\"handleSizeChange\"\r\n          @current-change=\"handlePageChange\"\r\n        />\r\n      </el-card>\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  import { Picture as ElIconPicture } from '@element-plus/icons-vue'\r\n  import { mapState, mapActions } from 'vuex'\r\n  \r\n  export default {\r\n    name: 'BookManagement',\r\n    components: {\r\n      ElIconPicture\r\n    },\r\n    data() {\r\n      return {\r\n        searchQuery: '',\r\n        currentPage: 1,\r\n        pageSize: 10\r\n      }\r\n    },\r\n    computed: {\r\n      ...mapState('admin', ['books', 'loading']),\r\n      total() {\r\n        return this.books.length // 实际项目应从API获取\r\n      }\r\n    },\r\n    methods: {\r\n      ...mapActions('admin', ['fetchBooks', 'approveBook', 'deleteBook']),\r\n      \r\n      formatStatus(status) {\r\n        const statusMap = {\r\n          pending: '待审核',\r\n          approved: '已通过',\r\n          rejected: '已拒绝'\r\n        }\r\n        return statusMap[status] || status\r\n      },\r\n      \r\n      handleSearch() {\r\n        this.currentPage = 1\r\n        this.fetchBooks({\r\n          query: this.searchQuery,\r\n          page: this.currentPage,\r\n          pageSize: this.pageSize\r\n        })\r\n      },\r\n      \r\n      handleSizeChange(size) {\r\n        this.pageSize = size\r\n        this.fetchBooks({\r\n          query: this.searchQuery,\r\n          page: this.currentPage,\r\n          pageSize: this.pageSize\r\n        })\r\n      },\r\n      \r\n      handlePageChange(page) {\r\n        this.currentPage = page\r\n        this.fetchBooks({\r\n          query: this.searchQuery,\r\n          page: this.currentPage,\r\n          pageSize: this.pageSize\r\n        })\r\n      },\r\n      \r\n      async handleApprove(bookId) {\r\n        try {\r\n          await this.approveBook(bookId)\r\n          this.$message.success('书籍已通过审核')\r\n        } catch (error) {\r\n          this.$message.error(error.message)\r\n        }\r\n      },\r\n      \r\n      async handleDelete(bookId) {\r\n        try {\r\n          await this.$confirm('确定删除此书籍吗？', '警告', {\r\n            type: 'warning'\r\n          })\r\n          await this.deleteBook(bookId)\r\n          this.$message.success('书籍已删除')\r\n        } catch (error) {\r\n          if (error !== 'cancel') {\r\n            this.$message.error(error.message)\r\n          }\r\n        }\r\n      }\r\n    },\r\n    created() {\r\n      this.fetchBooks()\r\n    }\r\n  }\r\n  </script>\r\n  \r\n  <style scoped>\r\n  .image-error {\r\n    width: 60px;\r\n    height: 80px;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    background: #f5f7fa;\r\n    color: #c0c4cc;\r\n  }\r\n  \r\n  /* 其他样式同UserManagement */\r\n  </style>"],"mappings":"AA6FE,SAASA,OAAM,IAAKC,aAAY,QAAS,yBAAwB;AACjE,SAASC,QAAQ,EAAEC,UAAS,QAAS,MAAK;AAE1C,eAAe;EACbC,IAAI,EAAE,gBAAgB;EACtBC,UAAU,EAAE;IACVJ;EACF,CAAC;EACDK,IAAIA,CAAA,EAAG;IACL,OAAO;MACLC,WAAW,EAAE,EAAE;MACfC,WAAW,EAAE,CAAC;MACdC,QAAQ,EAAE;IACZ;EACF,CAAC;EACDC,QAAQ,EAAE;IACR,GAAGR,QAAQ,CAAC,OAAO,EAAE,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;IAC1CS,KAAKA,CAAA,EAAG;MACN,OAAO,IAAI,CAACC,KAAK,CAACC,MAAK,EAAE;IAC3B;EACF,CAAC;EACDC,OAAO,EAAE;IACP,GAAGX,UAAU,CAAC,OAAO,EAAE,CAAC,YAAY,EAAE,aAAa,EAAE,YAAY,CAAC,CAAC;IAEnEY,YAAYA,CAACC,MAAM,EAAE;MACnB,MAAMC,SAAQ,GAAI;QAChBC,OAAO,EAAE,KAAK;QACdC,QAAQ,EAAE,KAAK;QACfC,QAAQ,EAAE;MACZ;MACA,OAAOH,SAAS,CAACD,MAAM,KAAKA,MAAK;IACnC,CAAC;IAEDK,YAAYA,CAAA,EAAG;MACb,IAAI,CAACb,WAAU,GAAI;MACnB,IAAI,CAACc,UAAU,CAAC;QACdC,KAAK,EAAE,IAAI,CAAChB,WAAW;QACvBiB,IAAI,EAAE,IAAI,CAAChB,WAAW;QACtBC,QAAQ,EAAE,IAAI,CAACA;MACjB,CAAC;IACH,CAAC;IAEDgB,gBAAgBA,CAACC,IAAI,EAAE;MACrB,IAAI,CAACjB,QAAO,GAAIiB,IAAG;MACnB,IAAI,CAACJ,UAAU,CAAC;QACdC,KAAK,EAAE,IAAI,CAAChB,WAAW;QACvBiB,IAAI,EAAE,IAAI,CAAChB,WAAW;QACtBC,QAAQ,EAAE,IAAI,CAACA;MACjB,CAAC;IACH,CAAC;IAEDkB,gBAAgBA,CAACH,IAAI,EAAE;MACrB,IAAI,CAAChB,WAAU,GAAIgB,IAAG;MACtB,IAAI,CAACF,UAAU,CAAC;QACdC,KAAK,EAAE,IAAI,CAAChB,WAAW;QACvBiB,IAAI,EAAE,IAAI,CAAChB,WAAW;QACtBC,QAAQ,EAAE,IAAI,CAACA;MACjB,CAAC;IACH,CAAC;IAED,MAAMmB,aAAaA,CAACC,MAAM,EAAE;MAC1B,IAAI;QACF,MAAM,IAAI,CAACC,WAAW,CAACD,MAAM;QAC7B,IAAI,CAACE,QAAQ,CAACC,OAAO,CAAC,SAAS;MACjC,EAAE,OAAOC,KAAK,EAAE;QACd,IAAI,CAACF,QAAQ,CAACE,KAAK,CAACA,KAAK,CAACC,OAAO;MACnC;IACF,CAAC;IAED,MAAMC,YAAYA,CAACN,MAAM,EAAE;MACzB,IAAI;QACF,MAAM,IAAI,CAACO,QAAQ,CAAC,WAAW,EAAE,IAAI,EAAE;UACrCC,IAAI,EAAE;QACR,CAAC;QACD,MAAM,IAAI,CAACC,UAAU,CAACT,MAAM;QAC5B,IAAI,CAACE,QAAQ,CAACC,OAAO,CAAC,OAAO;MAC/B,EAAE,OAAOC,KAAK,EAAE;QACd,IAAIA,KAAI,KAAM,QAAQ,EAAE;UACtB,IAAI,CAACF,QAAQ,CAACE,KAAK,CAACA,KAAK,CAACC,OAAO;QACnC;MACF;IACF;EACF,CAAC;EACDK,OAAOA,CAAA,EAAG;IACR,IAAI,CAACjB,UAAU,CAAC;EAClB;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}